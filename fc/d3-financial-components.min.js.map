{"version":3,"file":"d3-financial-components.min.js","sources":["..\\components\\fc.js","..\\components\\utilities\\chartLayout.js","..\\components\\utilities\\dataGenerator.js","..\\components\\utilities\\weekday.js","..\\components\\indicators\\bollingerBands.js","..\\components\\indicators\\movingAverage.js","..\\components\\indicators\\relativeStrengthIndex.js","..\\components\\scale\\financeScale.js","..\\components\\scale\\gridlines.js","..\\components\\scale\\linearScale.js","..\\components\\series\\candlestick.js","..\\components\\series\\comparison.js","..\\components\\series\\line.js","..\\components\\series\\ohlc.js","..\\components\\series\\volume.js","..\\components\\tools\\annotation.js","..\\components\\tools\\callouts.js","..\\components\\tools\\crosshairs.js","..\\components\\tools\\fibonacciFan.js","..\\components\\tools\\measure.js"],"names":[],"mappings":"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","sourcesContent":["fc = {\r\n    version: '0.0.0',\r\n    indicators: {},\r\n    scale: {},\r\n    series: {},\r\n    tools: {},\r\n    utilities: {}\r\n};","(function (d3, fc) {\r\n    'use strict';\r\n\r\n    fc.utilities.chartLayout = function () {\r\n\r\n        // Default values\r\n        var margin = {top: 20, right: 20, bottom: 20, left: 20},\r\n            width = 0,\r\n            height = 0;\r\n\r\n        var defaultWidth = true,\r\n            defaultHeight = true;\r\n\r\n        var chartLayout = function (selection) {\r\n            selection.each( function () {\r\n                var element = d3.select(this),\r\n                    style = getComputedStyle(this);\r\n\r\n                // Attempt to automatically size the chart to the selected element\r\n                if (defaultWidth === true) {\r\n                    // Set the width of the chart to the width of the selected element,\r\n                    // excluding any margins, padding or borders\r\n                    var paddingWidth = parseInt(style.paddingLeft, 10) + parseInt(style.paddingRight, 10);\r\n                    width = this.clientWidth - paddingWidth;\r\n\r\n                    // If the new width is too small, use a default width\r\n                    if (chartLayout.innerWidth() < 1) {\r\n                        width = 800 + margin.left + margin.right;\r\n                    }\r\n                }\r\n\r\n                if (defaultHeight === true) {\r\n                    // Set the height of the chart to the height of the selected element,\r\n                    // excluding any margins, padding or borders\r\n                    var paddingHeight = parseInt(style.paddingTop, 10) + parseInt(style.paddingBottom, 10);\r\n                    height = this.clientHeight - paddingHeight;\r\n\r\n                    // If the new height is too small, use a default height\r\n                    if (chartLayout.innerHeight() < 1) {\r\n                        height = 400 + margin.top + margin.bottom;\r\n                    }\r\n                }\r\n\r\n                // Create svg\r\n                var svg = element.append('svg')\r\n                    .attr('width', width)\r\n                    .attr('height', height);\r\n\r\n                // Create group for the chart\r\n                var chart =  svg.append('g')\r\n                    .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')');\r\n\r\n                // Clipping path\r\n                chart.append('defs').append('clipPath')\r\n                    .attr('id', 'plotAreaClip')\r\n                    .append('rect')\r\n                    .attr({ width: chartLayout.innerWidth(), height: chartLayout.innerHeight() });\r\n\r\n                // Create plot area, using the clipping path\r\n                chart.append('g')\r\n                    .attr('clip-path', 'url(#plotAreaClip)')\r\n                    .attr('class', 'plotArea');\r\n            });\r\n        };\r\n\r\n        chartLayout.marginTop = function (value) {\r\n            if (!arguments.length) {\r\n                return margin.top;\r\n            }\r\n            margin.top = value;\r\n            return chartLayout;\r\n        };\r\n\r\n        chartLayout.marginRight = function (value) {\r\n            if (!arguments.length) {\r\n                return margin.right;\r\n            }\r\n            margin.right = value;\r\n            return chartLayout;\r\n        };\r\n\r\n        chartLayout.marginBottom = function (value) {\r\n            if (!arguments.length) {\r\n                return margin.bottom;\r\n            }\r\n            margin.bottom = value;\r\n            return chartLayout;\r\n        };\r\n\r\n        chartLayout.marginLeft = function (value) {\r\n            if (!arguments.length) {\r\n                return margin.left;\r\n            }\r\n            margin.left = value;\r\n            return chartLayout;\r\n        };\r\n\r\n        chartLayout.width = function (value) {\r\n            if (!arguments.length) {\r\n                return width;\r\n            }\r\n            width = value;\r\n            defaultWidth = false;\r\n            return chartLayout;\r\n        };\r\n\r\n        chartLayout.height = function (value) {\r\n            if (!arguments.length) {\r\n                return height;\r\n            }\r\n            height = value;\r\n            defaultHeight = false;\r\n            return chartLayout;\r\n        };\r\n\r\n        chartLayout.innerWidth = function () {\r\n            var innerWidth = width - margin.left - margin.right;\r\n            return innerWidth;\r\n        };\r\n\r\n        chartLayout.innerHeight = function () {\r\n            var innerHeight = height - margin.top - margin.bottom;\r\n            return innerHeight;\r\n        };\r\n\r\n        return chartLayout;\r\n    };\r\n}(d3, fc));","(function (fc) {\r\n    'use strict';\r\n\r\n    fc.utilities.dataGenerator = function () {\r\n\r\n        var mu = 0.1,\r\n            sigma = 0.1,\r\n            startingPrice = 100,\r\n            startingVolume = 100000,\r\n            intraDaySteps = 50,\r\n            volumeNoiseFactor = 0.3,\r\n            toDate = new Date(),\r\n            fromDate = new Date(),\r\n            useFakeBoxMuller = false,\r\n            filter = function (date) {\r\n                return !(date.getDay() === 0 || date.getDay() === 6);\r\n            };\r\n\r\n        var generatePrices = function (period, steps) {\r\n            var increments = generateIncrements(period, steps, mu, sigma),\r\n                i, prices = [];\r\n            prices[0] = startingPrice;\r\n\r\n            for (i = 1; i < increments.length; i += 1) {\r\n                prices[i] = prices[i - 1] * increments[i];\r\n            }\r\n            return prices;\r\n        };\r\n\r\n        var generateVolumes = function (period, steps) {\r\n            var increments = generateIncrements(period, steps, 0, 1),\r\n                i, volumes = [];\r\n\r\n            volumeNoiseFactor = Math.max(0, Math.min(volumeNoiseFactor, 1));\r\n            volumes[0] = startingVolume;\r\n\r\n            for (i = 1; i < increments.length; i += 1) {\r\n                volumes[i] = volumes[i - 1] * increments[i];\r\n            }\r\n            volumes = volumes.map(function (vol) {\r\n                return Math.floor(vol * (1 - volumeNoiseFactor + Math.random() * volumeNoiseFactor * 2));\r\n            });\r\n            return volumes;\r\n        };\r\n\r\n        var generateIncrements = function (period, steps, mu, sigma) {\r\n            var deltaW = [],\r\n                deltaY = period / steps,\r\n                sqrtDeltaY = Math.sqrt(deltaY);\r\n\r\n            for(var i=0; i<steps; i++ ) {\r\n                var r = useFakeBoxMuller ?\r\n                    fakeBoxMullerTransform() :\r\n                    boxMullerTransform()[0];\r\n                r *= sqrtDeltaY;\r\n                r *= sigma;\r\n                r += (mu - ((sigma * sigma) / 2)) * deltaY;\r\n                deltaW.push(Math.exp(r));\r\n            }\r\n            return deltaW;\r\n        };\r\n\r\n        var boxMullerTransform = function() {\r\n            var x = 0, y = 0, rds, c;\r\n\r\n            // Get two random numbers from -1 to 1.\r\n            // If the radius is zero or greater than 1, throw them out and pick two new ones\r\n            do {\r\n                x = Math.random()*2-1;\r\n                y = Math.random()*2-1;\r\n                rds = x*x + y*y;\r\n            }\r\n            while (rds === 0 || rds > 1);\r\n\r\n            // This is the Box-Muller Transform\r\n            c = Math.sqrt(-2*Math.log(rds)/rds);\r\n\r\n            // It always creates a pair of numbers but it is quite efficient so don't be afraid to throw one away if you don't need both.\r\n            return [x*c, y*c];\r\n        };\r\n\r\n        var fakeBoxMullerTransform = function() {\r\n            return (Math.random()*2-1)+(Math.random()*2-1)+(Math.random()*2-1);\r\n        };\r\n\r\n        var generate = function() {\r\n\r\n            var msec_per_year = 3.15569e10,\r\n                rangeYears = (toDate.getTime() - fromDate.getTime()) / msec_per_year,\r\n                daysIncluded = 0,\r\n                prices,\r\n                volume,\r\n                ohlcv = [],\r\n                daySteps,\r\n                currentStep = 0,\r\n                currentIntraStep = 0;\r\n\r\n            var date = new Date(fromDate.getTime());\r\n            while (date <= toDate) {\r\n                if (!filter || filter(date)) {\r\n                    daysIncluded += 1;\r\n                }\r\n                date.setDate(date.getDate()+1);\r\n            }\r\n\r\n            prices = generatePrices(rangeYears, daysIncluded * intraDaySteps);\r\n            volume = generateVolumes(rangeYears, daysIncluded);\r\n\r\n            date = new Date(fromDate.getTime());\r\n            while(date <= toDate) {\r\n                if (!filter || filter(date)) {\r\n                    daySteps = prices.slice(currentIntraStep, currentIntraStep + intraDaySteps);\r\n                    ohlcv.push({\r\n                        date: new Date(date.getTime()),\r\n                        open: daySteps[0],\r\n                        high: Math.max.apply({}, daySteps),\r\n                        low: Math.min.apply({}, daySteps),\r\n                        close: daySteps[intraDaySteps - 1],\r\n                        volume: volume[currentStep]\r\n                    });\r\n                    currentIntraStep += intraDaySteps;\r\n                    currentStep += 1;\r\n                }\r\n                date.setDate(date.getDate()+1);\r\n            }\r\n\r\n            return ohlcv;\r\n        };\r\n\r\n        var dataGenerator = function (selection) {\r\n        };\r\n\r\n        dataGenerator.generate = function() {\r\n            return generate();\r\n        };\r\n\r\n        dataGenerator.mu = function (value) {\r\n            if (!arguments.length) {\r\n                return mu;\r\n            }\r\n            mu = value;\r\n            return dataGenerator;\r\n        };\r\n\r\n        dataGenerator.sigma = function (value) {\r\n            if (!arguments.length) {\r\n                return sigma;\r\n            }\r\n            sigma = value;\r\n            return dataGenerator;\r\n        };\r\n\r\n        dataGenerator.startingPrice = function (value) {\r\n            if (!arguments.length) {\r\n                return startingPrice;\r\n            }\r\n            startingPrice = value;\r\n            return dataGenerator;\r\n        };\r\n\r\n        dataGenerator.startingVolume = function (value) {\r\n            if (!arguments.length) {\r\n                return startingVolume;\r\n            }\r\n            startingVolume = value;\r\n            return dataGenerator;\r\n        };\r\n\r\n        dataGenerator.intraDaySteps = function (value) {\r\n            if (!arguments.length) {\r\n                return intraDaySteps;\r\n            }\r\n            intraDaySteps = value;\r\n            return dataGenerator;\r\n        };\r\n\r\n        dataGenerator.volumeNoiseFactor = function (value) {\r\n            if (!arguments.length) {\r\n                return volumeNoiseFactor;\r\n            }\r\n            volumeNoiseFactor = value;\r\n            return dataGenerator;\r\n        };\r\n\r\n        dataGenerator.filter = function (value) {\r\n            if (!arguments.length) {\r\n                return filter;\r\n            }\r\n            filter = value;\r\n            return dataGenerator;\r\n        };\r\n\r\n        dataGenerator.toDate = function (value) {\r\n            if (!arguments.length) {\r\n                return toDate;\r\n            }\r\n            toDate = value;\r\n            return dataGenerator;\r\n        };\r\n\r\n        dataGenerator.fromDate = function (value) {\r\n            if (!arguments.length) {\r\n                return fromDate;\r\n            }\r\n            fromDate = value;\r\n            return dataGenerator;\r\n        };\r\n\r\n        return dataGenerator;\r\n    };\r\n}(fc));","(function(d3, fc) {\r\n    'use strict';\r\n\r\n    var weekdayCache = {};\r\n    var dateCache = {};\r\n\r\n    // Returns the weekday number for the given date relative to January 1, 1970.\r\n    function weekday(date) {\r\n\r\n        if (date in weekdayCache) {\r\n            return weekdayCache[date];\r\n        }\r\n\r\n        var weekdays = weekdayOfYear(date),\r\n            year = date.getFullYear();\r\n\r\n        while (--year >= 1970) {\r\n            weekdays += weekdaysInYear(year);\r\n        }\r\n\r\n        weekdayCache[date] = weekdays;\r\n        return weekdays;\r\n    }\r\n\r\n    // Returns the date for the specified weekday number relative to January 1, 1970.\r\n    weekday.invert = function(weekdays) {\r\n        if (weekdays in dateCache) {\r\n            return dateCache[weekdays];\r\n        }\r\n        var year = 1970,\r\n            yearWeekdays,\r\n            result;\r\n\r\n        // Compute the year.\r\n        while ((yearWeekdays = weekdaysInYear(year)) <= weekdays) {\r\n            ++year;\r\n            weekdays -= yearWeekdays;\r\n        }\r\n\r\n        // Compute the date from the remaining weekdays.\r\n        var days = weekdays % 5,\r\n            day0 = ((new Date(year, 0, 1)).getDay() + 6) % 7;\r\n        if (day0 + days > 4) {\r\n            days += 2;\r\n        }\r\n\r\n        result = new Date(year, 0, (weekdays / 5 | 0) * 7 + days + 1);\r\n        dateCache[weekdays] = result;\r\n        return result;\r\n    };\r\n\r\n    // Returns the number of weekdays in the specified year.\r\n    function weekdaysInYear(year) {\r\n        return weekdayOfYear(new Date(year, 11, 31)) + 1;\r\n    }\r\n\r\n    // Returns the weekday number for the given date relative to the start of the year.\r\n    function weekdayOfYear(date) {\r\n        var days = d3.time.dayOfYear(date),\r\n            weeks = days / 7 | 0,\r\n            day0 = (d3.time.year(date).getDay() + 6) % 7,\r\n            day1 = day0 + days - weeks * 7;\r\n        return Math.max(0, days - weeks * 2\r\n            - (day0 <= 5 && day1 >= 5 || day0 <= 12 && day1 >= 12) // extra saturday\r\n            - (day0 <= 6 && day1 >= 6 || day0 <= 13 && day1 >= 13)); // extra sunday\r\n    }\r\n\r\n    fc.utilities.weekday = weekday;\r\n\r\n}(d3, fc));\r\n","(function (d3, fc) {\r\n\t'use strict';\r\n\r\n\tfc.indicators.bollingerBands = function () {\r\n\r\n\t\tvar xScale = d3.time.scale(),\r\n\t\t\tyScale = d3.scale.linear();\r\n\r\n\t\tvar yValue = 0,\r\n\t\t\tmovingAverage = 20,\r\n\t\t\tstandardDeviations = 2;\r\n\r\n\t\tvar cssBandArea = 'bollingerBandArea',\r\n\t\t\tcssBandUpper = 'bollingerBandUpper',\r\n\t\t\tcssBandLower = 'bollingerBandLower',\r\n\t\t\tcssAverage = 'bollingerAverage';\r\n\r\n\t\tvar bollingerBands = function (selection) {\r\n\r\n\t\t\tvar areaBands = d3.svg.area(),\r\n\t\t\t\tlineUpper = d3.svg.line(),\r\n\t\t\t\tlineLower = d3.svg.line(),\r\n\t\t\t\tlineAverage = d3.svg.line();\r\n\r\n\t\t\tareaBands.x(function (d) { return xScale(d.date); });\r\n\t\t\tlineUpper.x(function (d) { return xScale(d.date); });\r\n\t\t\tlineLower.x(function (d) { return xScale(d.date); });\r\n\t\t\tlineAverage.x(function (d) { return xScale(d.date); });\r\n\r\n\t\t\tvar calculateMovingAverage = function (data, i) {\r\n\r\n\t\t\t\tif (movingAverage === 0) {\r\n\t\t\t\t\treturn data[i][yValue];\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar count = Math.min(movingAverage, i + 1),\r\n\t\t\t\tfirst = i + 1 - count;\r\n\r\n\t\t\t\tvar sum = 0;\r\n\t\t\t\tfor (var index = first; index <= i; ++index) {\r\n\t\t\t\t\tvar x = data[index][yValue];\r\n\t\t\t\t\tsum += x;\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn sum / count;\r\n\t\t\t};\r\n\r\n\t\t\tvar calculateMovingStandardDeviation = function (data, i, avg) {\r\n\r\n\t\t\t\tif (movingAverage === 0) {\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar count = Math.min(movingAverage, i + 1),\r\n\t\t\t\t\tfirst = i + 1 - count;\r\n\r\n\t\t\t\tvar sum = 0;\r\n\t\t\t\tfor (var index = first; index <= i; ++index) {\r\n\t\t\t\t\tvar x = data[index][yValue];\r\n\t\t\t\t\tvar dx = x - avg;\r\n\t\t\t\t\tsum += (dx * dx);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar variance = sum / count;\r\n\t\t\t\treturn Math.sqrt(variance);\r\n\t\t\t};\r\n\r\n\t\t\tselection.each(function (data) {\r\n\r\n\t\t\t\tvar bollingerData = {};\r\n\t\t\t\tfor (var index = 0; index < data.length; ++index) {\r\n\r\n\t\t\t\t\tvar date = data[index].date;\r\n\r\n\t\t\t\t\tvar avg = calculateMovingAverage(data, index);\r\n\t\t\t\t\tvar sd = calculateMovingStandardDeviation(data, index, avg);\r\n\r\n\t\t\t\t\tbollingerData[date] = {avg: avg, sd: sd};\r\n\t\t\t\t}\r\n\r\n\t\t\t\tareaBands.y0(function (d) {\r\n\r\n\t\t\t\t\tvar avg = bollingerData[d.date].avg;\r\n\t\t\t\t\tvar sd = bollingerData[d.date].sd;\r\n\r\n\t\t\t\t\treturn yScale(avg + (sd * standardDeviations));\r\n\t\t\t\t});\r\n\r\n\t\t\t\tareaBands.y1(function (d) {\r\n\r\n\t\t\t\t\tvar avg = bollingerData[d.date].avg;\r\n\t\t\t\t\tvar sd = bollingerData[d.date].sd;\r\n\r\n\t\t\t\t\treturn yScale(avg - (sd * standardDeviations));\r\n\t\t\t\t});\r\n\r\n\t\t\t\tlineUpper.y(function (d) {\r\n\r\n\t\t\t\t\tvar avg = bollingerData[d.date].avg;\r\n\t\t\t\t\tvar sd = bollingerData[d.date].sd;\r\n\r\n\t\t\t\t\treturn yScale(avg + (sd * standardDeviations));\r\n\t\t\t\t});\r\n\r\n\t\t\t\tlineLower.y(function (d) {\r\n\r\n\t\t\t\t\tvar avg = bollingerData[d.date].avg;\r\n\t\t\t\t\tvar sd = bollingerData[d.date].sd;\r\n\r\n\t\t\t\t\treturn yScale(avg - (sd * standardDeviations));\r\n\t\t\t\t});\r\n\r\n\t\t\t\tlineAverage.y(function (d) {\r\n\r\n\t\t\t\t\tvar avg = bollingerData[d.date].avg;\r\n\r\n\t\t\t\t\treturn yScale(avg);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tvar prunedData = [];\r\n\t\t\t\tfor (var n = movingAverage; n < data.length; ++n) {\r\n\t\t\t\t\tprunedData.push(data[n]);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar pathArea = d3.select(this).selectAll('.area')\r\n\t\t\t\t\t.data([prunedData]);\r\n\t\t\t\tvar pathUpper = d3.select(this).selectAll('.upper')\r\n\t\t\t\t\t.data([prunedData]);\r\n\t\t\t\tvar pathLower = d3.select(this).selectAll('.lower')\r\n\t\t\t\t\t.data([prunedData]);\r\n\t\t\t\tvar pathAverage = d3.select(this).selectAll('.average')\r\n\t\t\t\t\t.data([prunedData]);\r\n\r\n\t\t\t\tpathArea.enter().append('path');\r\n\t\t\t\tpathUpper.enter().append('path');\r\n\t\t\t\tpathLower.enter().append('path');\r\n\t\t\t\tpathAverage.enter().append('path');\r\n\r\n\t\t\t\tpathArea.attr('d', areaBands)\r\n\t\t\t\t\t.classed('area', true)\r\n\t\t\t\t\t.classed(cssBandArea, true);\r\n\t\t\t\tpathUpper.attr('d', lineUpper)\r\n\t\t\t\t\t.classed('upper', true)\r\n\t\t\t\t\t.classed(cssBandUpper, true);\r\n\t\t\t\tpathLower.attr('d', lineLower)\r\n\t\t\t\t\t.classed('lower', true)\r\n\t\t\t\t\t.classed(cssBandLower, true);\r\n\t\t\t\tpathAverage.attr('d', lineAverage)\r\n\t\t\t\t\t.classed('average', true)\r\n\t\t\t\t\t.classed(cssAverage, true);\r\n\r\n\t\t\t\tpathArea.exit().remove();\r\n\t\t\t\tpathUpper.exit().remove();\r\n\t\t\t\tpathLower.exit().remove();\r\n\t\t\t\tpathAverage.exit().remove();\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tbollingerBands.xScale = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn xScale;\r\n\t\t\t}\r\n\t\t\txScale = value;\r\n\t\t\treturn bollingerBands;\r\n\t\t};\r\n\r\n\t\tbollingerBands.yScale = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn yScale;\r\n\t\t\t}\r\n\t\t\tyScale = value;\r\n\t\t\treturn bollingerBands;\r\n\t\t};\r\n\r\n\t\tbollingerBands.yValue = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn yValue;\r\n\t\t\t}\r\n\t\t\tyValue = value;\r\n\t\t\treturn bollingerBands;\r\n\t\t};\r\n\r\n\t\tbollingerBands.movingAverage = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn movingAverage;\r\n\t\t\t}\r\n\t\t\tif (value >= 0) {\r\n\t\t\t\tmovingAverage = value;\r\n\t\t\t}\r\n\t\t\treturn bollingerBands;\r\n\t\t};\r\n\r\n\t\tbollingerBands.standardDeviations = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn standardDeviations;\r\n\t\t\t}\r\n\t\t\tif (value >= 0) {\r\n\t\t\t\tstandardDeviations = value;\r\n\t\t\t}\r\n\t\t\treturn bollingerBands;\r\n\t\t};\r\n\r\n\t\tbollingerBands.cssBandUpper = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn cssBandUpper;\r\n\t\t\t}\r\n\t\t\tcssBandUpper = value;\r\n\t\t\treturn bollingerBands;\r\n\t\t};\r\n\r\n\t\tbollingerBands.cssBandLower = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn cssBandLower;\r\n\t\t\t}\r\n\t\t\tcssBandLower = value;\r\n\t\t\treturn bollingerBands;\r\n\t\t};\r\n\r\n\t\tbollingerBands.cssBandArea = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn cssBandArea;\r\n\t\t\t}\r\n\t\t\tcssBandArea = value;\r\n\t\t\treturn bollingerBands;\r\n\t\t};\r\n\r\n\t\tbollingerBands.cssAverage = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn cssAverage;\r\n\t\t\t}\r\n\t\t\tcssAverage = value;\r\n\t\t\treturn bollingerBands;\r\n\t\t};\r\n\r\n\t\treturn bollingerBands;\r\n\t};\r\n}(d3, fc));\r\n","(function (d3, fc) {\r\n\t'use strict';\r\n\r\n\tfc.indicators.movingAverage = function () {\r\n\r\n\t\tvar xScale = d3.time.scale(),\r\n\t\t\tyScale = d3.scale.linear(),\r\n\t\t\tyValue = 0,\r\n\t\t\taveragePoints = 5,\r\n\t\t\tcss = '';\r\n\r\n\t\tvar movingAverage = function (selection) {\r\n\t\t\tvar line = d3.svg.line();\r\n\t\t\tline.x(function (d) { return xScale(d.date); });\r\n\r\n\t\t\tselection.each(function (data) {\r\n\r\n\t\t\t\tif (!isNaN(parseFloat(yValue))) {\r\n\t\t\t\t\tline.y(yScale(yValue));\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tif (averagePoints === 0) {\r\n\t\t\t\t\t\tline.y(function (d) { return yScale(d[yValue]); });\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tline.y(function (d, i) {\r\n\t\t\t\t\t\t\tvar count = Math.min(averagePoints, i + 1),\r\n\t\t\t\t\t\t\t    first = i + 1 - count;\r\n\r\n\t\t\t\t\t\t\tvar sum = 0;\r\n\t\t\t\t\t\t\tfor (var index = first; index <= i; ++index) {\r\n\t\t\t\t\t\t\t    sum += data[index][yValue];\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tvar mean = sum / count;\r\n\r\n\t\t\t\t\t\t\treturn yScale(mean);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar path = d3.select(this).selectAll('.indicator')\r\n\t\t\t\t\t.data([data]);\r\n\r\n\t\t\t\tpath.enter().append('path');\r\n\r\n\t\t\t\tpath.attr('d', line)\r\n\t\t\t\t\t.classed('indicator', true)\r\n\t\t\t\t\t.classed(css, true);\r\n\r\n\t\t\t\tpath.exit().remove();\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tmovingAverage.xScale = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn xScale;\r\n\t\t\t}\r\n\t\t\txScale = value;\r\n\t\t\treturn movingAverage;\r\n\t\t};\r\n\r\n\t\tmovingAverage.yScale = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn yScale;\r\n\t\t\t}\r\n\t\t\tyScale = value;\r\n\t\t\treturn movingAverage;\r\n\t\t};\r\n\r\n\t\tmovingAverage.yValue = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn yValue;\r\n\t\t\t}\r\n\t\t\tyValue = value;\r\n\t\t\treturn movingAverage;\r\n\t\t};\r\n\r\n\t\tmovingAverage.averagePoints = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn averagePoints;\r\n\t\t\t}\r\n\t\t\tif (value >= 0) {\r\n\t\t\taveragePoints = value;\r\n\t\t\t}\r\n\t\t\treturn movingAverage;\r\n\t\t};\r\n\r\n\t\tmovingAverage.css = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn css;\r\n\t\t\t}\r\n\t\t\tcss = value;\r\n\t\t\treturn movingAverage;\r\n\t\t};\r\n\r\n\t\treturn movingAverage;\r\n\t};\r\n}(d3, fc));\r\n","(function (d3, fc) {\r\n\t'use strict';\r\n\r\n\tfc.indicators.rsi = function () {\r\n\r\n\t\tvar xScale = d3.time.scale(),\r\n\t\t\tyScale = d3.scale.linear(),\r\n\t\t\tsamplePeriods = 14,\r\n\t\t\tupperMarker = 70,\r\n\t\t\tlowerMarker = 30,\r\n\t\t\tlambda = 1.0,\r\n\t\t\tcss = '';\r\n\r\n\t\tvar upper = null,\r\n\t\t\tcentre = null,\r\n\t\t\tlower = null;\r\n\r\n\t\tvar rsi = function (selection) {\r\n\r\n\t\t\tselection.selectAll('.marker').remove();\r\n\r\n\t\t\tupper = selection.append(\"line\")\r\n\t\t\t\t.attr('class', 'marker upper')\r\n\t\t\t\t.attr('x1', xScale.range()[0]) \r\n\t\t\t\t.attr('y1', yScale(upperMarker))\r\n\t\t\t\t.attr('x2', xScale.range()[1]) \r\n\t\t\t\t.attr('y2', yScale(upperMarker));\r\n\r\n\t\t\tcentre = selection.append('line')\r\n\t\t\t\t.attr('class', 'marker centre')\r\n\t\t\t\t.attr('x1', xScale.range()[0]) \r\n\t\t\t\t.attr('y1', yScale(50))\r\n\t\t\t\t.attr('x2', xScale.range()[1]) \r\n\t\t\t\t.attr('y2', yScale(50));\r\n\r\n\t\t\tlower = selection.append('line')\r\n\t\t\t\t.attr('class', 'marker lower')\r\n\t\t\t\t.attr('x1', xScale.range()[0]) \r\n\t\t\t\t.attr('y1', yScale(lowerMarker))\r\n\t\t\t\t.attr('x2', xScale.range()[1]) \r\n\t\t\t\t.attr('y2', yScale(lowerMarker));\r\n\r\n\t\t\tvar line = d3.svg.line();\r\n\t\t\tline.x(function (d) { return xScale(d.date); });\r\n\r\n\t\t\tselection.each(function (data) {\r\n\r\n\t\t\t\tif (samplePeriods === 0) {\r\n\t\t\t\t\tline.y(function (d) { return yScale(0); });\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tline.y(function (d, i) {\r\n\t\t\t\t\t\tvar from = i - samplePeriods,\r\n\t\t\t\t\t\t\tto = i,\r\n\t\t\t\t\t\t\tup = [],\r\n\t\t\t\t\t\t\tdown = [];\r\n\r\n\t\t\t\t\t\tif (from < 1) {\r\n                            from = 1;\r\n                        }\r\n\r\n\t\t\t\t\t\tfor( var offset = to; offset >= from; offset--) {\r\n\t\t\t\t\t\t\tvar dnow = data[offset],\r\n\t\t\t\t\t\t\tdprev = data[offset-1];\r\n\r\n\t\t\t\t\t\t\tvar weight = Math.pow(lambda, offset);\r\n\t\t\t\t\t\t\tup.push(dnow.close > dprev.close ? (dnow.close - dprev.close) * weight : 0);\r\n\t\t\t\t\t\t\tdown.push(dnow.close < dprev.close ? (dprev.close - dnow.close) * weight : 0);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (up.length <= 0 || down.length <= 0) {\r\n                            return yScale(0);\r\n                        }\r\n\r\n\t\t\t\t\t\tvar rsi = 100 - (100/(1+(d3.mean(up)/d3.mean(down))));\r\n\t\t\t\t\t\treturn yScale(rsi);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\r\n\t\t\t\tvar path = d3.select(this).selectAll('.rsi')\r\n\t\t\t\t\t.data([data]);\r\n\r\n\t\t\t\tpath.enter().append('path');\r\n\r\n\t\t\t\tpath.attr('d', line)\r\n\t\t\t\t\t.classed('rsi', true)\r\n\t\t\t\t\t.classed(css, true);\r\n\r\n\t\t\t\tpath.exit().remove();\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\trsi.xScale = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn xScale;\r\n\t\t\t}\r\n\t\t\txScale = value;\r\n\t\t\treturn rsi;\r\n\t\t};\r\n\r\n\t\trsi.yScale = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn yScale;\r\n\t\t\t}\r\n\t\t\tyScale = value;\r\n\t\t\treturn rsi;\r\n\t\t};\r\n\r\n\t\trsi.samplePeriods = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn samplePeriods;\r\n\t\t\t}\r\n\t\t\tsamplePeriods = value < 0 ? 0 : value;\r\n\t\t\treturn rsi;\r\n\t\t};\r\n\r\n\t\trsi.upperMarker = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn upperMarker;\r\n\t\t\t}\r\n\t\t\tupperMarker = value > 100 ? 100 : (value < 0 ? 0 : value);\r\n\t\t\treturn rsi;\r\n\t\t};\r\n\r\n\t\trsi.lowerMarker = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn lowerMarker;\r\n\t\t\t}\r\n\t\t\tlowerMarker = value > 100 ? 100 : (value < 0 ? 0 : value);\r\n\t\t\treturn rsi;\r\n\t\t};\r\n\r\n\t\trsi.lambda = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn lambda;\r\n\t\t\t}\r\n\t\t\tlambda = value > 1.0 ? 1.0 : (value < 0.0 ? 0.0 : value);\r\n\t\t\treturn rsi;\r\n\t\t};\r\n\r\n\t\trsi.css = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn css;\r\n\t\t\t}\r\n\t\t\tcss = value;\r\n\t\t\treturn rsi;\r\n\t\t};\r\n\r\n\t\treturn rsi;\r\n\t};\r\n}(d3, fc));","(function (d3, fc) {\r\n    'use strict';\r\n\r\n    var weekday = fc.utilities.weekday;\r\n\r\n    fc.scale.finance = function () {\r\n        return financialScale();\r\n    };\r\n\r\n    function financialScale(linear) {\r\n\r\n    \tvar alignPixels = true;\r\n\r\n        if (!arguments.length) {\r\n            linear = d3.scale.linear();\r\n        }\r\n\r\n        function scale(x) {\r\n            var n = 0;\r\n            if (typeof x === 'number') {\r\n                // When scaling ticks.\r\n                n = linear(x);\r\n            } else {\r\n                // When scaling dates.\r\n                n = linear(weekday(x));\r\n            }\r\n        \tvar m = Math.round(n);\r\n            return alignPixels ? (n > m ? m + 0.5 : m - 0.5) : n;\r\n        }\r\n\r\n        scale.copy = function () {\r\n            return financialScale(linear.copy());\r\n        };\r\n\r\n        scale.domain = function (domain) {\r\n            if (!arguments.length) {\r\n                return linear.domain().map(weekday.invert);\r\n            }\r\n            if (typeof domain[0] === 'number') {\r\n                linear.domain(domain);\r\n            } else {\r\n                linear.domain(domain.map(weekday));\r\n            }\r\n            return scale;\r\n        };\r\n\r\n        scale.ticks = function (n) {\r\n            return arguments.length ? linear.ticks(n) : linear.ticks();\r\n        };\r\n\r\n        scale.tickFormat = function (count, f) {\r\n            return function(n) {\r\n                var date = weekday.invert(n);\r\n                return d3.time.format('%b %e')(date);\r\n            };\r\n        };\r\n\r\n        scale.invert = function (pixel) {\r\n            return weekday.invert(linear.invert(pixel));\r\n        };\r\n\r\n        scale.alignPixels = function (value) {\r\n            if (!arguments.length) {\r\n                return alignPixels;\r\n            }\r\n            alignPixels = value;\r\n            return scale;\r\n        };\r\n\r\n        return d3.rebind(scale, linear, \"range\", \"rangeRound\", \"interpolate\", \"clamp\", \"nice\");\r\n    }\r\n}(d3, fc));","(function (d3, fc) {\r\n    'use strict';\r\n\r\n    fc.scale.gridlines = function () {\r\n\r\n        var xScale = d3.time.scale(),\r\n            yScale = d3.scale.linear(),\r\n            xTicks = 10,\r\n            yTicks = 10;\r\n\r\n        var xLines = function (data, grid) {\r\n            var xlines = grid.selectAll('.x')\r\n                .data(data);\r\n            xlines\r\n                .enter().append('line')\r\n                .attr({\r\n                    'class': 'x',\r\n                    'x1': function(d) { return xScale(d);},\r\n                    'x2': function(d) { return xScale(d);},\r\n                    'y1': yScale.range()[0],\r\n                    'y2': yScale.range()[1]\r\n                });\r\n            xlines\r\n                .attr({\r\n                    'x1': function(d) { return xScale(d);},\r\n                    'x2': function(d) { return xScale(d);},\r\n                    'y1': yScale.range()[0],\r\n                    'y2': yScale.range()[1]\r\n                });\r\n            xlines.exit().remove();\r\n        };\r\n\r\n        var yLines = function (data, grid) {\r\n            var ylines = grid.selectAll('.y')\r\n                .data(data);\r\n            ylines\r\n                .enter().append('line')\r\n                .attr({\r\n                    'class': 'y',\r\n                    'x1': xScale.range()[0],\r\n                    'x2': xScale.range()[1],\r\n                    'y1': function(d) { return yScale(d);},\r\n                    'y2': function(d) { return yScale(d);}\r\n                });\r\n            ylines\r\n                .attr({\r\n                    'x1': xScale.range()[0],\r\n                    'x2': xScale.range()[1],\r\n                    'y1': function(d) { return yScale(d);},\r\n                    'y2': function(d) { return yScale(d);}\r\n                });\r\n            ylines.exit().remove();\r\n        };\r\n\r\n        var gridlines = function (selection) {\r\n            var grid, xTickData, yTickData;\r\n\r\n            selection.each(function () {\r\n                xTickData = xScale.ticks(xTicks);\r\n                yTickData = yScale.ticks(yTicks);\r\n\r\n                grid = d3.select(this).selectAll('.gridlines').data([[xTickData, yTickData]]);\r\n                grid.enter().append('g').classed('gridlines', true);\r\n                xLines(xTickData, grid);\r\n                yLines(yTickData, grid);\r\n            });\r\n        };\r\n\r\n        gridlines.xScale = function (value) {\r\n            if (!arguments.length) {\r\n                return xScale;\r\n            }\r\n            xScale = value;\r\n            return gridlines;\r\n        };\r\n\r\n        gridlines.yScale = function (value) {\r\n            if (!arguments.length) {\r\n                return yScale;\r\n            }\r\n            yScale = value;\r\n            return gridlines;\r\n        };\r\n\r\n        gridlines.xTicks = function (value) {\r\n            if (!arguments.length) {\r\n                return xTicks;\r\n            }\r\n            xTicks = value;\r\n            return gridlines;\r\n        };\r\n\r\n        gridlines.yTicks = function (value) {\r\n            if (!arguments.length) {\r\n                return yTicks;\r\n            }\r\n            yTicks = value;\r\n            return gridlines;\r\n        };\r\n\r\n        return gridlines;\r\n    };\r\n}(d3, fc));\r\n","(function (d3, fc) {\r\n    'use strict';\r\n\r\n    fc.scale.linear = function () {\r\n        return linearScale();\r\n    };\r\n\r\n    function linearScale(linear) {\r\n    \t\r\n    \tvar alignPixels = true;\r\n\r\n        if (!arguments.length) {\r\n            linear = d3.scale.linear();\r\n        }\r\n\r\n        function scale(x) {\r\n        \tvar n = linear(x);\r\n        \tvar m = Math.round(n);\r\n            return alignPixels ? (n > m ? m + 0.5 : m - 0.5) : n;\r\n        }\r\n\r\n        scale.copy = function () {\r\n            return linearScale(linear.copy());\r\n        };\r\n\r\n        scale.domain = function (domain) {\r\n            linear.domain(domain);\r\n            return scale;\r\n        };\r\n\r\n        scale.ticks = function (n) {\r\n            return linear.ticks(n);\r\n        };\r\n\r\n        scale.invert = function (pixel) {\r\n            return linear.invert(pixel);\r\n        };\r\n\r\n        scale.alignPixels = function (value) {\r\n            if (!arguments.length) {\r\n                return alignPixels;\r\n            }\r\n            alignPixels = value;\r\n            return scale;\r\n        };\r\n\r\n        return d3.rebind(scale, linear, \"range\", \"rangeRound\", \"interpolate\", \"clamp\", \"nice\");\r\n    }\r\n}(d3, fc));","(function (d3, fc) {\r\n    'use strict';\r\n\r\n    fc.series.candlestick = function () {\r\n\r\n        var xScale = d3.time.scale(),\r\n            yScale = d3.scale.linear();\r\n\r\n        var rectangleWidth = 5;\r\n\r\n        var isUpDay = function(d) {\r\n            return d.close > d.open;\r\n        };\r\n        var isDownDay = function (d) {\r\n            return !isUpDay(d);\r\n        };\r\n\r\n        var line = d3.svg.line()\r\n            .x(function (d) {\r\n                return d.x;\r\n            })\r\n            .y(function (d) {\r\n                return d.y;\r\n            });\r\n\r\n        var highLowLines = function (bars) {\r\n\r\n            var paths = bars.selectAll('.high-low-line').data(function (d) {\r\n                return [d];\r\n            });\r\n\r\n            paths.enter().append('path');\r\n\r\n            paths.classed('high-low-line', true)\r\n                .attr('d', function (d) {\r\n                    return line([\r\n                        { x: xScale(d.date), y: yScale(d.high) },\r\n                        { x: xScale(d.date), y: yScale(d.low) }\r\n                    ]);\r\n                });\r\n        };\r\n\r\n        var rectangles = function (bars) {\r\n            var rect;\r\n\r\n            rect = bars.selectAll('rect').data(function (d) {\r\n                return [d];\r\n            });\r\n\r\n            rect.enter().append('rect');\r\n\r\n            rect.attr('x', function (d) {\r\n                return xScale(d.date) - (rectangleWidth/2.0);\r\n            })\r\n                .attr('y', function (d) {\r\n                    return isUpDay(d) ? yScale(d.close) : yScale(d.open);\r\n                })\r\n                .attr('width', rectangleWidth)\r\n                .attr('height', function (d) {\r\n                    return isUpDay(d) ?\r\n                        yScale(d.open) - yScale(d.close) :\r\n                        yScale(d.close) - yScale(d.open);\r\n                });\r\n        };\r\n\r\n        var candlestick = function (selection) {\r\n            var series, bars;\r\n\r\n            selection.each(function (data) {\r\n                series = d3.select(this).selectAll('.candlestick-series').data([data]);\r\n\r\n                series.enter().append('g')\r\n                    .classed('candlestick-series', true);\r\n\r\n                bars = series.selectAll('.bar')\r\n                    .data(data, function (d) {\r\n                        return d.date;\r\n                    });\r\n\r\n                bars.enter()\r\n                    .append('g')\r\n                    .classed('bar', true);\r\n\r\n                bars.classed({\r\n                    'up-day': isUpDay,\r\n                    'down-day': isDownDay\r\n                });\r\n\r\n                highLowLines(bars);\r\n                rectangles(bars);\r\n\r\n                bars.exit().remove();\r\n\r\n\r\n            });\r\n        };\r\n\r\n        candlestick.xScale = function (value) {\r\n            if (!arguments.length) {\r\n                return xScale;\r\n            }\r\n            xScale = value;\r\n            return candlestick;\r\n        };\r\n\r\n        candlestick.yScale = function (value) {\r\n            if (!arguments.length) {\r\n                return yScale;\r\n            }\r\n            yScale = value;\r\n            return candlestick;\r\n        };\r\n\r\n        candlestick.rectangleWidth = function (value) {\r\n            if (!arguments.length) {\r\n                return rectangleWidth;\r\n            }\r\n            rectangleWidth = value;\r\n            return candlestick;\r\n        };\r\n\r\n        return candlestick;\r\n\r\n    };\r\n}(d3, fc));\r\n","// TODO where is yScaleTransform?\r\n(function (d3, fc, yScaleTransform) {\r\n    'use strict';\r\n\r\n    fc.series.comparison = function () {\r\n\r\n        var xScale = d3.time.scale(),\r\n            yScale = d3.scale.linear();\r\n\r\n        var cachedData, cachedScale;\r\n\r\n        var findIndex = function (seriesData, date) {\r\n            var bisect = d3.bisector(\r\n                function (d) {\r\n                    return d.date;\r\n                }).left;\r\n\r\n            var initialIndex = bisect(seriesData, date);\r\n            if (!initialIndex) {\r\n                initialIndex += 1;\r\n            }\r\n            return initialIndex;\r\n        };\r\n\r\n        var percentageChange = function (seriesData, initialDate) {\r\n            var initialIndex = findIndex(seriesData, initialDate) - 1;\r\n            var initialClose = seriesData[initialIndex].close;\r\n\r\n            return seriesData.map(function (d) {\r\n                return {\r\n                    date: d.date,\r\n                    change: (d.close / initialClose) - 1\r\n                };\r\n            });\r\n        };\r\n\r\n        var rebaseChange = function (seriesData, initialDate) {\r\n            var initialIndex = findIndex(seriesData, initialDate) - 1;\r\n            var initialChange = seriesData[initialIndex].change;\r\n\r\n            return seriesData.map(function (d) {\r\n                return {\r\n                    date: d.date,\r\n                    change: d.change - initialChange\r\n                };\r\n            });\r\n        };\r\n\r\n         var calculateYDomain = function (data, xDomain) {\r\n            var start, end;\r\n\r\n            data = data.map(function (series) {\r\n                series = series.data;\r\n                start = findIndex(series,xDomain[0]) - 1;\r\n                end = findIndex(series,xDomain[1]) + 1;\r\n                return series.slice(start, end);\r\n            });\r\n\r\n            var allPoints = data.reduce(function(prev, curr) {\r\n                return prev.concat(curr);\r\n            }, []);\r\n\r\n            if (allPoints.length) {\r\n                return d3.extent(allPoints, function(d) {\r\n                    return d.change;\r\n                });\r\n            } else {\r\n                return [0, 0];\r\n            }\r\n        };\r\n\r\n        var color = d3.scale.category10();\r\n\r\n        var line = d3.svg.line()\r\n            .interpolate(\"linear\")\r\n            .x(function (d) {\r\n                return xScale(d.date);\r\n            })\r\n            .y(function (d) {\r\n                return yScale(d.change);\r\n            });\r\n\r\n        var comparison = function (selection) {\r\n            var series, lines;\r\n\r\n            selection.each(function (data) {\r\n\r\n                data = data.map(function (d) {\r\n                    return {\r\n                        name: d.name,\r\n                        data: percentageChange(d.data, xScale.domain()[0])\r\n                    };\r\n                });\r\n\r\n                cachedData = data; // Save for rebasing.\r\n\r\n                color.domain(data.map(function (d) {\r\n                    return d.name;\r\n                }));\r\n\r\n                yScale.domain(calculateYDomain(data, xScale.domain()));\r\n                cachedScale = yScale.copy();\r\n\r\n                series = d3.select(this).selectAll('.comparison-series').data([data]);\r\n                series.enter().append('g').classed('comparison-series', true);\r\n\r\n                lines = series.selectAll('.line')\r\n                    .data(data, function(d) {\r\n                        return d.name;\r\n                    })\r\n                    .enter().append(\"path\")\r\n                    .attr(\"class\", \"line\")\r\n                    .attr(\"d\", function (d) {\r\n                        return line(d.data);\r\n                    })\r\n                    .style(\"stroke\", function (d) {\r\n                        return color(d.name);\r\n                    });\r\n\r\n                series.selectAll('.line')\r\n                    .attr(\"d\", function (d) {\r\n                        return line(d.data);\r\n                    });\r\n            });\r\n        };\r\n\r\n        comparison.geometricZoom = function (selection, xTransformTranslate, xTransformScale) {\r\n            // Apply a transformation for each line to update its position wrt the new initial date,\r\n            // then apply the yScale transformation to reflect the updated yScale domain.\r\n\r\n            var initialIndex,\r\n                yTransform;\r\n\r\n            var lineTransform = function (initialChange) {\r\n                var yTransformLineTranslate = cachedScale(0) - cachedScale(initialChange);\r\n\r\n                yTransformLineTranslate *= yTransform.scale;\r\n                yTransformLineTranslate += yTransform.translate;\r\n\r\n                return 'translate(' + xTransformTranslate + ',' + yTransformLineTranslate + ')' +\r\n                    ' scale(' + xTransformScale + ',' + yTransform.scale + ')';\r\n            };\r\n\r\n            var domainData = cachedData.map(function (d) {\r\n                return {\r\n                    name: d.name,\r\n                    data: rebaseChange(d.data, xScale.domain()[0])\r\n                };\r\n            });\r\n\r\n            yScale.domain(calculateYDomain(domainData, xScale.domain()));\r\n            yTransform = yScaleTransform(cachedScale, yScale);\r\n\r\n            cachedData = cachedData.map(function (d) {\r\n                initialIndex = findIndex(d.data, xScale.domain()[0]) - 1;\r\n                return {\r\n                    name: d.name,\r\n                    data: d.data,\r\n                    transform: lineTransform(d.data[initialIndex].change)\r\n                };\r\n            });\r\n\r\n            selection.selectAll('.line')\r\n                .data(cachedData)\r\n                .attr('transform', function (d) { return d.transform; });\r\n        };\r\n\r\n        comparison.xScale = function (value) {\r\n            if (!arguments.length) {\r\n                return xScale;\r\n            }\r\n            xScale = value;\r\n            return comparison;\r\n        };\r\n\r\n        comparison.yScale = function (value) {\r\n            if (!arguments.length) {\r\n                return yScale;\r\n            }\r\n            yScale = value;\r\n            return comparison;\r\n        };\r\n\r\n        return comparison;\r\n    };\r\n}(d3, fc));","(function (d3, fc) {\r\n\t'use strict';\r\n\r\n\tfc.series.line = function () {\r\n\r\n\t\tvar yValue = 'close',\r\n\t\t\txScale = fc.scale.finance(),\r\n\t\t\tyScale = fc.scale.linear(),\r\n\t\t\tunderFill = true;\r\n\r\n\t\tvar line = function (selection) {\r\n\r\n\t\t\tvar area;\r\n\r\n\t\t\tif(underFill) {\r\n\t\t\t\tarea = d3.svg.area()\r\n\t\t\t      \t.x(function(d) { return xScale(d.date); })\r\n\t\t\t    \t.y0(yScale(0));\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvar line = d3.svg.line();\r\n\t\t\tline.x(function (d) { return xScale(d.date); });\r\n\r\n\t\t\tselection.each(function (data) {\r\n\r\n\t\t\t\tif(underFill) {\r\n\t\t\t\t\tarea.y1(function (d) { return yScale(d[yValue]); });\r\n\t\t\t\t\tvar areapath = d3.select(this).selectAll('.lineSeriesArea')\r\n\t\t\t\t\t\t.data([data]);\r\n\t\t\t\t\tareapath.enter()\r\n\t\t\t\t\t\t.append('path')\r\n\t\t\t\t\t\t.attr('d', area)\r\n\t\t\t\t\t\t.classed('lineSeriesArea', true);\r\n\t\t\t\t\tareapath.exit()\r\n\t\t\t\t\t\t.remove();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tline.y(function (d) { return yScale(d[yValue]); });\r\n\t\t\t\tvar linepath = d3.select(this).selectAll('.lineSeries')\r\n\t\t\t\t\t.data([data]);\r\n\t\t\t\tlinepath.enter()\r\n\t\t\t\t\t.append('path')\r\n\t\t\t\t\t.attr('d', line)\r\n\t\t\t\t\t.classed('lineSeries', true);\r\n\t\t\t\tlinepath.exit()\r\n\t\t\t\t\t.remove();\r\n\t\t\t});\r\n\t\t};\r\n\r\n\t\tline.yValue = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn yValue;\r\n\t\t\t}\r\n\t\t\tyValue = value;\r\n\t\t\treturn line;\r\n\t\t};\r\n\r\n\t\tline.xScale = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn xScale;\r\n\t\t\t}\r\n\t\t\txScale = value;\r\n\t\t\treturn line;\r\n\t\t};\r\n\r\n\t\tline.yScale = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn yScale;\r\n\t\t\t}\r\n\t\t\tyScale = value;\r\n\t\t\treturn line;\r\n\t\t};\r\n\r\n\t\tline.underFill = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn underFill;\r\n\t\t\t}\r\n\t\t\tunderFill = value;\r\n\t\t\treturn line;\r\n\t\t};\r\n\r\n\t\treturn line;\r\n\t};\r\n}(d3, fc));","(function (d3, fc) {\r\n    'use strict';\r\n\r\n    fc.series.ohlc = function (drawMethod) {\r\n\r\n        // Configurable attributes\r\n        var xScale = d3.time.scale(),\r\n            yScale = d3.scale.linear(),\r\n            tickWidth = 5;\r\n\r\n        // Function to return\r\n        var ohlc;\r\n\r\n        // Accessor functions\r\n        var open = function (d) {\r\n                return yScale(d.open);\r\n            },\r\n            high = function (d) {\r\n                return yScale(d.high);\r\n            },\r\n            low = function (d) {\r\n                return yScale(d.low);\r\n            },\r\n            close = function (d) {\r\n                return yScale(d.close);\r\n            },\r\n            date = function (d) {\r\n                return xScale(d.date);\r\n            };\r\n\r\n        // Up/down day logic\r\n        var isUpDay = function(d) {\r\n            return d.close > d.open;\r\n        };\r\n        var isDownDay = function (d) {\r\n            return d.close < d.open;\r\n        };\r\n        var isStaticDay = function (d) {\r\n            return d.close === d.open;\r\n        };\r\n\r\n        var barColour = function(d) {\r\n            if (isUpDay(d)) {\r\n                return 'green';\r\n            } else if (isDownDay(d)) {\r\n                return 'red';\r\n            } else {\r\n                return 'black';\r\n            }\r\n        };\r\n\r\n        // Path drawing\r\n        var makeBarPath = function (d) {\r\n            var moveToLow = 'M' + date(d) + ',' + low(d),\r\n                verticalToHigh = 'V' + high(d),\r\n                openTick = 'M' + date(d) + \",\" + open(d) + 'h' + (-tickWidth),\r\n                closeTick = 'M' + date(d) + \",\" + close(d) + 'h' + tickWidth;\r\n            return moveToLow + verticalToHigh + openTick + closeTick;\r\n        };\r\n\r\n        var makeConcatPath = function (data) {\r\n            var path = 'M0,0';\r\n            data.forEach(function (d) {\r\n                path += makeBarPath(d);\r\n            });\r\n            return path;\r\n        };\r\n\r\n        // Filters data, and draws a series of ohlc bars from the result as a single path.\r\n        var makeConcatPathElement = function(series, elementClass, colour, data, filterFunction) {\r\n            var concatPath;\r\n            var filteredData = data.filter(function (d) {\r\n                return filterFunction(d);\r\n            });\r\n            concatPath = series.selectAll('.' + elementClass)\r\n                .data([filteredData]);\r\n\r\n            concatPath.enter()\r\n                .append('path')\r\n                .classed(elementClass, true);\r\n\r\n            concatPath\r\n                .attr('d', makeConcatPath(filteredData))\r\n                .attr('stroke', colour);\r\n\r\n\r\n            concatPath.exit().remove();\r\n        };\r\n\r\n        // Common series element\r\n        var makeSeriesElement = function (selection, data) {\r\n            var series = d3.select(selection).selectAll('.ohlc-series').data([data]);\r\n            series.enter().append('g').classed('ohlc-series', true);\r\n            return series;\r\n        };\r\n\r\n        // Draw ohlc bars as groups of svg lines\r\n        var ohlcLineGroups = function (selection) {\r\n            selection.each(function (data) {\r\n                var series = makeSeriesElement(this, data);\r\n\r\n                var bars = series.selectAll('.bar')\r\n                    .data(data, function (d) {\r\n                        return d.date;\r\n                    });\r\n\r\n                // Enter\r\n                var barEnter = bars.enter().append('g').classed('bar', true);\r\n                barEnter.append('line').classed('high-low-line', true);\r\n                barEnter.append('line').classed('open-tick', true);\r\n                barEnter.append('line').classed('close-tick', true);\r\n\r\n                // Update\r\n                bars.classed({\r\n                    'up-day': isUpDay,\r\n                    'down-day': isDownDay,\r\n                    'static-day': isStaticDay\r\n                });\r\n\r\n                bars.attr('stroke', barColour);\r\n\r\n                bars.select('.high-low-line').attr({x1: date, y1: low, x2: date, y2: high });\r\n                bars.select('.open-tick').attr({\r\n                    x1: function (d) { return date(d) - tickWidth; },\r\n                    y1: open,\r\n                    x2: date,\r\n                    y2: open\r\n                });\r\n                bars.select('.close-tick').attr({\r\n                    x1: date,\r\n                    y1: close,\r\n                    x2: function (d) { return date(d) + tickWidth; },\r\n                    y2: close\r\n                });\r\n\r\n                // Exit\r\n                bars.exit().remove();\r\n            });\r\n        };\r\n\r\n        // Draw ohlc bars as svg paths\r\n        var ohlcBarPaths = function (selection) {\r\n            selection.each(function (data) {\r\n                var series = makeSeriesElement(this, data);\r\n\r\n                var bars = series.selectAll('.bar')\r\n                    .data(data, function (d) {\r\n                        return d.date;\r\n                    });\r\n\r\n                bars.enter()\r\n                    .append('path')\r\n                    .classed('bar', true);\r\n\r\n                bars.classed({\r\n                    'up-day': isUpDay,\r\n                    'down-day': isDownDay,\r\n                    'static-day': isStaticDay\r\n                });\r\n\r\n                bars.attr({\r\n                    'stroke': barColour,\r\n                    'd': makeBarPath\r\n                });\r\n\r\n                bars.exit().remove();\r\n            });\r\n        };\r\n\r\n        // Draw the complete series of ohlc bars using 3 paths\r\n        var ohlcConcatBarPaths = function (selection) {\r\n            selection.each(function (data) {\r\n                var series = makeSeriesElement(this, data);\r\n                makeConcatPathElement(series, 'up-days', 'green', data, isUpDay);\r\n                makeConcatPathElement(series, 'down-days', 'red' ,data, isDownDay);\r\n                makeConcatPathElement(series, 'static-days', 'black', data, isStaticDay);\r\n            });\r\n        };\r\n\r\n        switch (drawMethod) {\r\n            case 'line': ohlc = ohlcLineGroups; break;\r\n            case 'path': ohlc = ohlcBarPaths; break;\r\n            case 'paths': ohlc = ohlcConcatBarPaths; break;\r\n            default: ohlc = ohlcBarPaths;\r\n        }\r\n\r\n        ohlc.xScale = function (value) {\r\n            if (!arguments.length) {\r\n                return xScale;\r\n            }\r\n            xScale = value;\r\n            return ohlc;\r\n        };\r\n\r\n        ohlc.yScale = function (value) {\r\n            if (!arguments.length) {\r\n                return yScale;\r\n            }\r\n            yScale = value;\r\n            return ohlc;\r\n        };\r\n\r\n        ohlc.tickWidth = function (value) {\r\n            if (!arguments.length) {\r\n                return tickWidth;\r\n            }\r\n            tickWidth = value;\r\n            return ohlc;\r\n        };\r\n\r\n        return ohlc;\r\n    };\r\n}(d3, fc));","(function (d3, fc) {\r\n    'use strict';\r\n\r\n    fc.series.volume = function () {\r\n\r\n        var xScale = d3.time.scale(),\r\n            yScale = d3.scale.linear(),\r\n            barWidth = 5,\r\n            yValue = 'volume';\r\n\r\n        var isUpDay = function(d) {\r\n            return d.close > d.open;\r\n        };\r\n        var isDownDay = function (d) {\r\n            return !isUpDay(d);\r\n        };\r\n\r\n        var rectangles = function (bars) {\r\n            var rect;\r\n\r\n            rect = bars.selectAll('rect').data(function (d) {\r\n                return [d];\r\n            });\r\n\r\n            rect.enter().append('rect');\r\n\r\n            rect.attr('x', function (d) { return xScale(d.date) - (barWidth/2.0); })\r\n                .attr('y', function(d) { return yScale(d[yValue]); } )\r\n                .attr('width', barWidth)\r\n                .attr('height', function(d) { return yScale(0) - yScale(d.volume); });\r\n        };\r\n\r\n        var volume = function (selection) {\r\n            var series, bars;\r\n\r\n            selection.each(function (data) {\r\n                series = d3.select(this).selectAll('.volume-series').data([data]);\r\n\r\n                series.enter().append('g')\r\n                    .classed('volume-series', true);\r\n\r\n                bars = series.selectAll('.volumebar')\r\n                    .data(data, function (d) {\r\n                        return d.date;\r\n                    });\r\n\r\n                bars.enter()\r\n                    .append('g')\r\n                    .classed('volumebar', true);\r\n\r\n                bars.classed({\r\n                    'up-day': isUpDay,\r\n                    'down-day': isDownDay\r\n                });\r\n                rectangles(bars);\r\n                bars.exit().remove();\r\n           });\r\n        };\r\n\r\n        volume.xScale = function (value) {\r\n            if (!arguments.length) {\r\n                return xScale;\r\n            }\r\n            xScale = value;\r\n            return volume;\r\n        };\r\n\r\n        volume.yScale = function (value) {\r\n            if (!arguments.length) {\r\n                return yScale;\r\n            }\r\n            yScale = value;\r\n            return volume;\r\n        };\r\n\r\n        volume.barWidth = function (value) {\r\n            if (!arguments.length) {\r\n                return barWidth;\r\n            }\r\n            barWidth = value;\r\n            return volume;\r\n        };\r\n\r\n        volume.yValue = function (value) {\r\n            if (!arguments.length) {\r\n                return yValue;\r\n            }\r\n            yValue = value;\r\n            return volume;\r\n        };\r\n\r\n        return volume;\r\n    };\r\n}(d3, fc));\r\n","(function (d3, fc) {\r\n    'use strict';\r\n\r\n    fc.tools.annotation = function () {\r\n\r\n        var index = 0,\r\n            xScale = d3.time.scale(),\r\n            yScale = d3.scale.linear(),\r\n            yLabel = '',\r\n            yValue = 0,\r\n            padding = 2,\r\n            formatCallout = function(d) { return d; };\r\n\r\n        var root = null,\r\n            line = null,\r\n            callout = null;\r\n\r\n        var annotation = function (selection) {\r\n\r\n            root = selection.append('g')\r\n                .attr('id', 'annotation_' + index)\r\n                .attr('class', 'annotation');\r\n\r\n            line = root.append(\"line\")\r\n                .attr('class', 'marker')\r\n                .attr('x1', xScale.range()[0]) \r\n                .attr('y1', yScale(yValue))\r\n                .attr('x2', xScale.range()[1]) \r\n                .attr('y2', yScale(yValue));\r\n\r\n\r\n            callout = root.append(\"text\")\r\n                .attr('class', 'callout')\r\n                .attr('x', xScale.range()[1] - padding)\r\n                .attr('y', yScale(yValue) - padding)\r\n                .attr('style', 'text-anchor: end;')\r\n                .text(yLabel + \": \" + formatCallout(yValue));\r\n        };\r\n\r\n        annotation.index = function (value) {\r\n            if (!arguments.length) {\r\n                return index;\r\n            }\r\n            index = value;\r\n            return annotation;\r\n        };\r\n\r\n        annotation.xScale = function (value) {\r\n            if (!arguments.length) {\r\n                return xScale;\r\n            }\r\n            xScale = value;\r\n            return annotation;\r\n        };\r\n\r\n        annotation.yScale = function (value) {\r\n            if (!arguments.length) {\r\n                return yScale;\r\n            }\r\n            yScale = value;\r\n            return annotation;\r\n        };\r\n\r\n        annotation.yValue = function (value) {\r\n            if (!arguments.length) {\r\n                return yValue;\r\n            }\r\n            yValue = value;\r\n            return annotation;\r\n        };\r\n\r\n        annotation.yLabel = function (value) {\r\n            if (!arguments.length) {\r\n                return yLabel;\r\n            }\r\n            yLabel = value;\r\n            return annotation;\r\n        };\r\n\r\n        annotation.padding = function (value) {\r\n            if (!arguments.length) {\r\n                return padding;\r\n            }\r\n            padding = value;\r\n            return annotation;\r\n        };\r\n\r\n        annotation.formatCallout = function (value) {\r\n            if (!arguments.length) {\r\n                return formatCallout;\r\n            }\r\n            formatCallout = value;\r\n            return annotation;\r\n        };\r\n\r\n        return annotation;\r\n    };\r\n}(d3, fc));","(function (d3, fc) {\r\n\t\t'use strict';\r\n\r\n\t\tfc.tools.callouts = function () {\r\n\r\n\t\tvar xScale = d3.time.scale(),\r\n\t\t\tyScale = d3.scale.linear(),\r\n\t\t\tpadding = 5,\r\n\t\t\tspacing = 5,\r\n\t\t\trounded = 0,\r\n\t\t\trotationStart = 20,\r\n\t\t\trotationSteps = 20,\r\n\t\t\tstalkLength = 50,\r\n\t\t\tcss = 'callout',\r\n\t\t\tdata = [];\r\n\r\n\t\tvar currentBB = null,\r\n\t\t\tboundingBoxes = [],\r\n\t\t\tcurrentRotation = 0;\r\n\r\n\t\tvar rectanglesIntersect = function(r1, r2) {\r\n\t\t\treturn !(r2.left > r1.right || \r\n\t\t\t\tr2.right < r1.left || \r\n\t\t\t\tr2.top > r1.bottom ||\r\n\t\t\t\tr2.bottom < r1.top);\r\n\t\t};\r\n\r\n\t\tvar arrangeCallouts = function() {\r\n\r\n\t\t\tif (!boundingBoxes) {\r\n                return;\r\n            }\r\n\r\n\t\t\tvar sortedRects = boundingBoxes.sort(function(a,b) {\r\n\t\t\t\tif (a.y < b.y) {\r\n                    return -1;\r\n                }\r\n\t\t\t\tif (a.y > b.y) {\r\n                    return 1;\r\n                }\r\n\t\t\t\treturn 0;\r\n\t\t\t});\r\n\r\n\t\t\tcurrentRotation = rotationStart;\r\n\t\t\tfor(var i=0; i<sortedRects.length; i++) {\r\n\r\n\t\t\t\t// Calculate the x and y components of the stalk\r\n\t\t\t\tvar offsetX = stalkLength * Math.sin(currentRotation * (Math.PI/180));\r\n\t\t\t\tsortedRects[i].x += offsetX;\r\n\t\t\t\tvar offsetY = stalkLength * Math.cos(currentRotation * (Math.PI/180));\r\n\t\t\t\tsortedRects[i].y -= offsetY;\r\n\r\n\t\t\t\tcurrentRotation += rotationSteps;\r\n\t\t\t}\r\n\r\n\t\t\t// Tree sorting algo (Sudo code below)\r\n\t\t\tfor(var r1=0; r1<sortedRects.length; r1++ ){\r\n\t\t\t\tfor(var r2=r1+1; r2<sortedRects.length; r2++) {\r\n\r\n\t\t\t\t\tif( !sortedRects[r1].left ) {\r\n\t\t\t\t\t\tsortedRects[r1].left = function() { return this.x - padding; };\r\n\t\t\t\t\t\tsortedRects[r1].right = function() { return this.x + this.width + padding; };\r\n\t\t\t\t\t\tsortedRects[r1].bottom = function() { return this.y + this.height + padding; };\r\n\t\t\t\t\t\tsortedRects[r1].top = function() { return this.y - padding; };\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif( !sortedRects[r2].left ) {\r\n\t\t\t\t\t\tsortedRects[r2].left = function() { return this.x - padding; };\r\n\t\t\t\t\t\tsortedRects[r2].right = function() { return this.x + this.width + padding; };\r\n\t\t\t\t\t\tsortedRects[r2].bottom = function() { return this.y + this.height + padding; };\r\n\t\t\t\t\t\tsortedRects[r2].top = function() { return this.y - padding; };\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif(rectanglesIntersect(sortedRects[r1], sortedRects[r2])) {\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// Find the smallest move to correct the overlap\r\n\t\t\t\t\t\tvar smallest = 0; // 0=left, 1=right, 2=down\r\n\t\t\t\t\t\tvar left = sortedRects[r2].right() - sortedRects[r1].left();\r\n\t\t\t\t\t\tvar right = sortedRects[r1].right() - sortedRects[r2].left();\r\n\t\t\t\t\t\tif (right < left) {\r\n                            smallest = 1;\r\n                        }\r\n\t\t\t\t\t\tvar down = sortedRects[r1].bottom() - sortedRects[r2].top();\r\n\t\t\t\t\t\tif (down < right && down < left) {\r\n                            smallest = 2;\r\n                        }\r\n\r\n\t\t\t\t\t\tif (smallest === 0) {\r\n                            sortedRects[r2].x -= (left + spacing);\r\n                        }\r\n\t\t\t\t\t\telse if (smallest === 1) {\r\n                            sortedRects[r2].x += (right + spacing);\r\n                        }\r\n\t\t\t\t\t\telse if (smallest === 2) {\r\n                            sortedRects[r2].y += (down + spacing);\r\n                        }\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tboundingBoxes = sortedRects;\r\n\t\t};\r\n\r\n\t\tvar callouts = function (selection) {\r\n\r\n\t\t\t// Create the callouts\r\n\t\t\tvar callouts = selection.selectAll('g')\r\n\t\t\t\t.data(data)\r\n\t\t\t\t.enter()\r\n\t\t\t\t.append('g')\r\n\t\t\t\t.attr('transform', function(d) { return 'translate(' + xScale(d.x) + ',' + yScale(d.y) +')'; })\r\n\t\t\t\t.attr('class', function(d) { return d.css ? d.css : css; });\r\n\r\n\t\t\t// Create the text elements\r\n\t\t\tcallouts.append('text')\r\n\t\t\t\t.attr('style', 'text-anchor: left;')\r\n\t\t\t\t.text(function(d) { return d.label; });\r\n\r\n\t\t\t// Create the rectangles behind\r\n\t\t\tcallouts.insert('rect',':first-child')\r\n\t\t\t\t.attr('x', function(d) { return -padding - rounded; })\r\n\t\t\t\t.attr('y', function(d) { \r\n\t\t\t\t\tcurrentBB = this.parentNode.getBBox();\r\n\t\t\t\t\tcurrentBB.x = xScale(d.x); \r\n\t\t\t\t\tcurrentBB.y = yScale(d.y); \r\n\t\t\t\t\tboundingBoxes.push(currentBB); \r\n\t\t\t\t\treturn -currentBB.height; \r\n\t\t\t\t})\r\n\t\t\t\t.attr('width', function(d) { return currentBB.width + (padding*2) + (rounded*2); })\r\n\t\t\t\t.attr('height', function(d) { return currentBB.height + (padding*2); })\r\n\t\t\t\t.attr('rx', rounded)\r\n\t\t\t\t.attr('ry', rounded);\r\n\r\n\t\t\t// Arrange callout\r\n\t\t\tarrangeCallouts();\r\n\t\t\tvar index = 0;\r\n\t\t\tcallouts.attr('transform', function(d) { \r\n\t\t\t\treturn 'translate(' + boundingBoxes[index].x + ',' + boundingBoxes[index++].y +')';\r\n\t\t\t});\r\n\r\n\t\t\tcallouts = selection.selectAll('g')\r\n\t\t\t.data(data)\r\n\t\t\t.exit();\r\n\t\t};\r\n\r\n\t\tcallouts.addCallout = function (value) {\r\n\t\tdata.push(value);\r\n\t\t\treturn callouts;\r\n\t\t};\r\n\r\n\t\tcallouts.xScale = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn xScale;\r\n\t\t\t}\r\n\t\t\txScale = value;\r\n\t\t\treturn callouts;\r\n\t\t};\r\n\r\n\t\tcallouts.yScale = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn yScale;\r\n\t\t\t}\r\n\t\t\tyScale = value;\r\n\t\t\treturn callouts;\r\n\t\t};\r\n\r\n\t\tcallouts.padding = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn padding;\r\n\t\t\t}\r\n\t\t\tpadding = value;\r\n\t\t\treturn callouts;\r\n\t\t};\r\n\r\n\t\tcallouts.spacing = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn spacing;\r\n\t\t\t}\r\n\t\t\tspacing = value;\r\n\t\t\treturn callouts;\r\n\t\t};\r\n\r\n\t\tcallouts.rounded = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn rounded;\r\n\t\t\t}\r\n\t\t\trounded = value;\r\n\t\t\treturn callouts;\r\n\t\t};\r\n\r\n\t\tcallouts.stalkLength = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn stalkLength;\r\n\t\t\t}\r\n\t\t\tstalkLength = value;\r\n\t\t\treturn callouts;\r\n\t\t};\r\n\r\n\t\tcallouts.rotationStart = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn rotationStart;\r\n\t\t\t}\r\n\t\t\trotationStart = value;\r\n\t\t\treturn callouts;\r\n\t\t};\r\n\r\n\t\tcallouts.rotationSteps = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn rotationSteps;\r\n\t\t\t}\r\n\t\t\trotationSteps = value;\r\n\t\t\treturn callouts;\r\n\t\t};\r\n\r\n\t\tcallouts.css = function (value) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\treturn css;\r\n\t\t\t}\r\n\t\t\tcss = value;\r\n\t\t\treturn callouts;\r\n\t\t};\r\n\r\n\t\treturn callouts;\r\n\t};\r\n}(d3, fc));","(function (d3, fc) {\r\n    'use strict';\r\n\r\nfc.tools.crosshairs = function () {\r\n\r\n    var target = null,\r\n        series = null,\r\n        xScale = d3.time.scale(),\r\n        yScale = d3.scale.linear(),\r\n        yValue = null,\r\n        formatH = null,\r\n        formatV = null,\r\n        active = true,\r\n        freezable = true,\r\n        padding = 2,\r\n        onSnap = null;\r\n\r\n    var lineH = null,\r\n        lineV = null,\r\n        circle = null,\r\n        calloutH = null,\r\n        calloutV = null;\r\n\r\n    var highlight = null,\r\n        highlightedField = null;\r\n\r\n    var crosshairs = function () {\r\n\r\n        var root = target.append('g')\r\n            .attr('class', 'crosshairs');\r\n\r\n        lineH = root.append(\"line\")\r\n            .attr('class', 'crosshairs horizontal')\r\n            .attr('x1', xScale.range()[0])\r\n            .attr('x2', xScale.range()[1])\r\n            .attr('display', 'none');\r\n\r\n        lineV = root.append(\"line\")\r\n            .attr('class', 'crosshairs vertical')\r\n            .attr('y1', yScale.range()[0])\r\n            .attr('y2', yScale.range()[1])\r\n            .attr('display', 'none');\r\n\r\n        circle = root.append(\"circle\")\r\n            .attr('class', 'crosshairs circle')\r\n            .attr('r', 6)\r\n            .attr('display', 'none');\r\n\r\n        calloutH = root.append(\"text\")\r\n            .attr('class', 'crosshairs callout horizontal')\r\n            .attr('x', xScale.range()[1] - padding)\r\n            .attr('style', 'text-anchor: end')\r\n            .attr('display', 'none');\r\n\r\n        calloutV = root.append(\"text\")\r\n            .attr('class', 'crosshairs callout vertical')\r\n            .attr('y', '1em')\r\n            .attr('style', 'text-anchor: end')\r\n            .attr('display', 'none');\r\n    };\r\n\r\n    function mousemove() {\r\n\r\n        if (active) {\r\n            crosshairs.update();\r\n        }\r\n    }\r\n\r\n    function mouseout() {\r\n\r\n        if (active) {\r\n            crosshairs.clear();\r\n        }\r\n    }\r\n\r\n    function mouseclick() {\r\n\r\n        if (freezable) {\r\n            crosshairs.active(!active);\r\n        }\r\n    }\r\n\r\n    function findNearest(xTarget) {\r\n\r\n        var nearest = null,\r\n            dx = Number.MAX_VALUE;\r\n\r\n        series.forEach(function(data) {\r\n\r\n            var xDiff = Math.abs(xTarget.getTime() - data.date.getTime());\r\n\r\n            if (xDiff < dx) {\r\n                dx = xDiff;\r\n                nearest = data;\r\n            }\r\n        });\r\n\r\n        return nearest;\r\n    }\r\n\r\n    function findField(yTarget, data) {\r\n\r\n        var field = null;\r\n\r\n        var minDiff = Number.MAX_VALUE;\r\n        for (var property in data) {\r\n            if (data.hasOwnProperty(property) && (property !== 'date')) {\r\n                var dy = Math.abs(yTarget - data[property]);\r\n                if (dy <= minDiff) {\r\n                    minDiff = dy;\r\n                    field = property;\r\n                }\r\n            }\r\n        }\r\n\r\n        return field;\r\n    }\r\n\r\n    function redraw() {\r\n\r\n        var x = xScale(highlight.date),\r\n            y = yScale(highlight[highlightedField]);\r\n\r\n        lineH.attr('y1', y)\r\n            .attr('y2', y);\r\n        lineV.attr('x1', x)\r\n            .attr('x2', x);\r\n        circle.attr('cx', x)\r\n            .attr('cy', y);\r\n        calloutH.attr('y', y - padding)\r\n            .text(formatH(highlight[highlightedField], highlightedField));\r\n        calloutV.attr('x', x - padding)\r\n            .text(formatV(highlight.date));\r\n\r\n        lineH.attr('display', 'inherit');\r\n        lineV.attr('display', 'inherit');\r\n        circle.attr('display', 'inherit');\r\n        calloutH.attr('display', 'inherit');\r\n        calloutV.attr('display', 'inherit');\r\n    }\r\n\r\n    crosshairs.update = function() {\r\n\r\n        if (!active) {\r\n\r\n            redraw();\r\n\r\n        } else {\r\n\r\n            var mouse = [0, 0];\r\n            try {\r\n                mouse = d3.mouse(target[0][0]);\r\n            }\r\n            catch (exception) {\r\n                // Mouse is elsewhere\r\n            }\r\n\r\n            var xMouse = xScale.invert(mouse[0]),\r\n                yMouse = yScale.invert(mouse[1]),\r\n                nearest = findNearest(xMouse);\r\n\r\n            if (nearest !== null) {\r\n\r\n                var field = null;\r\n                if (nearest[yValue]) {\r\n                    field = yValue;\r\n                } else {\r\n                    field = findField(yMouse, nearest);\r\n                }\r\n\r\n                if ((nearest !== highlight) || (field !== highlightedField)) {\r\n\r\n                    highlight = nearest;\r\n                    highlightedField = field;\r\n\r\n                    redraw();\r\n                    if (onSnap) {\r\n                        onSnap(highlight);\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    };\r\n\r\n    crosshairs.clear = function() {\r\n\r\n        highlight = null;\r\n        highlightedField = null;\r\n\r\n        lineH.attr('display', 'none');\r\n        lineV.attr('display', 'none');\r\n        circle.attr('display', 'none');\r\n        calloutH.attr('display', 'none');\r\n        calloutV.attr('display', 'none');\r\n    };\r\n\r\n    crosshairs.target = function (value) {\r\n        if (!arguments.length) {\r\n            return target;\r\n        }\r\n\r\n        if (target) {\r\n\r\n            target.on('mousemove.crosshairs', null);\r\n            target.on('mouseout.crosshairs', null);\r\n            target.on('click.crosshairs', null);\r\n        }\r\n\r\n        target = value;\r\n\r\n        target.on('mousemove.crosshairs', mousemove);\r\n        target.on('mouseout.crosshairs', mouseout);\r\n        target.on('click.crosshairs', mouseclick);\r\n\r\n        return crosshairs;\r\n    };\r\n\r\n    crosshairs.series = function (value) {\r\n        if (!arguments.length) {\r\n            return series;\r\n        }\r\n        series = value;\r\n        return crosshairs;\r\n    };\r\n\r\n    crosshairs.xScale = function (value) {\r\n        if (!arguments.length) {\r\n            return xScale;\r\n        }\r\n        xScale = value;\r\n        return crosshairs;\r\n    };\r\n\r\n    crosshairs.yScale = function (value) {\r\n        if (!arguments.length) {\r\n            return yScale;\r\n        }\r\n        yScale = value;\r\n        return crosshairs;\r\n    };\r\n\r\n    crosshairs.yValue = function (value) {\r\n        if (!arguments.length) {\r\n            return yValue;\r\n        }\r\n        yValue = value;\r\n        return crosshairs;\r\n    };\r\n\r\n    crosshairs.formatH = function (value) {\r\n        if (!arguments.length) {\r\n            return formatH;\r\n        }\r\n        formatH = value;\r\n        return crosshairs;\r\n    };\r\n\r\n    crosshairs.formatV = function (value) {\r\n        if (!arguments.length) {\r\n            return formatV;\r\n        }\r\n        formatV = value;\r\n        return crosshairs;\r\n    };\r\n\r\n    crosshairs.active = function (value) {\r\n        if (!arguments.length) {\r\n            return active;\r\n        }\r\n        active = value;\r\n\r\n        lineH.classed('frozen', !active);\r\n        lineV.classed('frozen', !active);\r\n        circle.classed('frozen', !active);\r\n\r\n        return crosshairs;\r\n    };\r\n\r\n    crosshairs.freezable = function (value) {\r\n        if (!arguments.length) {\r\n            return freezable;\r\n        }\r\n        freezable = value;\r\n        return crosshairs;\r\n    };\r\n\r\n    crosshairs.padding = function (value) {\r\n        if (!arguments.length) {\r\n            return padding;\r\n        }\r\n        padding = value;\r\n        return crosshairs;\r\n    };\r\n\r\n    crosshairs.onSnap = function (value) {\r\n        if (!arguments.length) {\r\n            return onSnap;\r\n        }\r\n        onSnap = value;\r\n        return crosshairs;\r\n    };\r\n\r\n    crosshairs.highlightedPoint = function() {\r\n        return highlight;\r\n    };\r\n\r\n    crosshairs.highlightedField = function() {\r\n        return highlightedField;\r\n    };\r\n\r\n    return crosshairs;\r\n};\r\n\r\n}(d3, fc));","(function (d3, fc) {\r\n    'use strict';\r\n\r\n    fc.tools.fibonacciFan = function () {\r\n\r\n        var target = null,\r\n            series = null,\r\n            xScale = d3.time.scale(),\r\n            yScale = d3.scale.linear(),\r\n            active = true;\r\n\r\n        var circleOrigin = null,\r\n            circleTarget = null,\r\n            lineSource = null,\r\n            lineA = null,\r\n            lineB = null,\r\n            lineC = null,\r\n            fanArea = null;\r\n\r\n        var phase = 1,\r\n            locationOrigin = null,\r\n            locationTarget = null;\r\n\r\n        var fibonacciFan = function () {\r\n\r\n            var root = target.append('g')\r\n                .attr('class', 'fibonacci-fan');\r\n\r\n            circleOrigin = root.append(\"circle\")\r\n                .attr('class', 'fibonacci-fan origin')\r\n                .attr('r', 6)\r\n                .attr('display', 'none');\r\n\r\n            circleTarget = root.append(\"circle\")\r\n                .attr('class', 'fibonacci-fan target')\r\n                .attr('r', 6)\r\n                .attr('display', 'none');\r\n\r\n            lineSource = root.append(\"line\")\r\n                .attr('class', 'fibonacci-fan source')\r\n                .attr('display', 'none');\r\n\r\n            lineA = root.append(\"line\")\r\n                .attr('class', 'fibonacci-fan a')\r\n                .attr('display', 'none');\r\n\r\n            lineB = root.append(\"line\")\r\n                .attr('class', 'fibonacci-fan b')\r\n                .attr('display', 'none');\r\n\r\n            lineC = root.append(\"line\")\r\n                .attr('class', 'fibonacci-fan c')\r\n                .attr('display', 'none');\r\n\r\n            fanArea = root.append(\"polygon\")\r\n                .attr('class', 'fibonacci-fan area')\r\n                .attr('display', 'none');\r\n        };\r\n\r\n        function mousemove() {\r\n\r\n            if (!active) {\r\n                return;\r\n            }\r\n\r\n            switch (phase) {\r\n                case 1: {\r\n                    locationOrigin = findLocation();\r\n                    if (locationOrigin) {\r\n                        fibonacciFan.update();\r\n                        circleOrigin.attr('display', 'inherit');\r\n                    }\r\n                    break;\r\n                }\r\n                case 2: {\r\n                    locationTarget = findLocation();\r\n                    if (locationTarget) {\r\n                        fibonacciFan.update();\r\n                        circleTarget.attr('display', 'inherit');\r\n                        lineSource.attr('display', 'inherit');\r\n                    }\r\n                    break;\r\n                }\r\n                case 3: {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        function mouseclick() {\r\n\r\n            if (!active) {\r\n                return;\r\n            }\r\n\r\n            switch (phase) {\r\n                case 1: {\r\n\r\n                    phase = 2;\r\n                    break;\r\n                }\r\n                case 2: {\r\n\r\n                    setFan();\r\n\r\n                    phase = 3;\r\n                    break;\r\n                }\r\n                case 3: {\r\n\r\n                    clearAll();\r\n\r\n                    phase = 1;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        function findLocation() {\r\n\r\n            var mouse = [0, 0];\r\n            try {\r\n                mouse = d3.mouse(target[0][0]);\r\n            }\r\n            catch (exception) {\r\n                // Mouse is elsewhere\r\n            }\r\n\r\n            var xMouse = xScale.invert(mouse[0]),\r\n                yMouse = yScale.invert(mouse[1]),\r\n                point = findPoint(xMouse);\r\n\r\n            if (point !== null) {\r\n\r\n                var field = findField(yMouse, point);\r\n\r\n                if (field !== null) {\r\n\r\n                    return { point: point, field: field };\r\n                }\r\n            }\r\n\r\n            return null;\r\n        }\r\n\r\n        function findPoint(xTarget) {\r\n\r\n            var nearest = null,\r\n                dx = Number.MAX_VALUE;\r\n\r\n            series.forEach(function(data) {\r\n\r\n                var xDiff = Math.abs(xTarget.getTime() - data.date.getTime());\r\n\r\n                if (xDiff < dx) {\r\n                    dx = xDiff;\r\n                    nearest = data;\r\n                }\r\n            });\r\n\r\n            return nearest;\r\n        }\r\n\r\n        function findField(yTarget, data) {\r\n\r\n            var field = null;\r\n\r\n            var minDiff = Number.MAX_VALUE;\r\n            for (var property in data) {\r\n                if (data.hasOwnProperty(property) && (property !== 'date')) {\r\n                    var dy = Math.abs(yTarget - data[property]);\r\n                    if (dy <= minDiff) {\r\n                        minDiff = dy;\r\n                        field = property;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return field;\r\n        }\r\n\r\n        function setFan() {\r\n\r\n            if (xScale(locationOrigin.point.date) > xScale(locationTarget.point.date)) {\r\n                var tmp = locationOrigin;\r\n                locationOrigin = locationTarget;\r\n                locationTarget = tmp;\r\n            }\r\n\r\n            var originX = xScale(locationOrigin.point.date),\r\n                originY = yScale(locationOrigin.point[locationOrigin.field]),\r\n                targetX = xScale(locationTarget.point.date),\r\n                targetY = yScale(locationTarget.point[locationTarget.field]),\r\n                finalX = xScale.range()[1],\r\n                finalY = calculateY(originX, originY, targetX, targetY, finalX);\r\n\r\n            if (finalY) {\r\n\r\n                setFanLines(originX, originY, finalX, finalY.source, finalY.source, finalY.source);\r\n\r\n                lineA.attr('display', 'inherit');\r\n                lineB.attr('display', 'inherit');\r\n                lineC.attr('display', 'inherit');\r\n                fanArea.attr('display', 'inherit');\r\n\r\n                var pointsFinal = originX + ',' + originY\r\n                    + ' ' + finalX + ',' + finalY.a\r\n                    + ' ' + finalX + ',' + finalY.c;\r\n\r\n                lineA.transition()\r\n                    .attr('y2', finalY.a);\r\n                lineB.transition()\r\n                    .attr('y2', finalY.b);\r\n                lineC.transition()\r\n                    .attr('y2', finalY.c);\r\n                fanArea.transition()\r\n                    .attr('points', pointsFinal);\r\n            }\r\n\r\n            circleOrigin.attr('display', 'none');\r\n            circleTarget.attr('display', 'none');\r\n        }\r\n\r\n        function clearAll() {\r\n\r\n            locationOrigin = null;\r\n            locationTarget = null;\r\n\r\n            circleOrigin.attr('display', 'none');\r\n            circleTarget.attr('display', 'none');\r\n            lineSource.attr('display', 'none');\r\n            lineA.attr('display', 'none');\r\n            lineB.attr('display', 'none');\r\n            lineC.attr('display', 'none');\r\n            fanArea.attr('display', 'none');\r\n        }\r\n\r\n        function calculateY(originX, originY, targetX, targetY, finalX) {\r\n\r\n            if (originX === targetX) { return null; }\r\n\r\n            var gradient = (targetY - originY) / (targetX - originX),\r\n                ySource = (gradient * (finalX - originX)) + originY,\r\n                yA = ((gradient * 0.618) * (finalX - originX)) + originY,\r\n                yB = ((gradient * 0.500) * (finalX - originX)) + originY,\r\n                yC = ((gradient * 0.382) * (finalX - originX)) + originY;\r\n\r\n            return {source: ySource, a: yA, b: yB, c: yC};\r\n        }\r\n\r\n        function setFanLines(originX, originY, finalX, finalYa, finalYb, finalYc) {\r\n\r\n            var points = originX + ',' + originY\r\n                + ' ' + finalX + ',' + finalYa\r\n                + ' ' + finalX + ',' + finalYc;\r\n\r\n            lineA.attr('x1', originX)\r\n                .attr('y1', originY)\r\n                .attr('x2', finalX)\r\n                .attr('y2', finalYa);\r\n            lineB.attr('x1', originX)\r\n                .attr('y1', originY)\r\n                .attr('x2', finalX)\r\n                .attr('y2', finalYb);\r\n            lineC.attr('x1', originX)\r\n                .attr('y1', originY)\r\n                .attr('x2', finalX)\r\n                .attr('y2', finalYc);\r\n            fanArea.attr('points', points);\r\n        }\r\n\r\n        fibonacciFan.update = function () {\r\n\r\n            if (locationOrigin) {\r\n\r\n                var originX = xScale(locationOrigin.point.date),\r\n                    originY = yScale(locationOrigin.point[locationOrigin.field]);\r\n\r\n                circleOrigin.attr('cx', originX)\r\n                    .attr('cy', originY);\r\n                lineSource.attr('x1', originX)\r\n                    .attr('y1', originY);\r\n\r\n                if (locationTarget && (phase !== 1)) {\r\n\r\n                    var targetX = xScale(locationTarget.point.date),\r\n                        targetY = yScale(locationTarget.point[locationTarget.field]);\r\n\r\n                    circleTarget.attr('cx', targetX)\r\n                        .attr('cy', targetY);\r\n                    lineSource.attr('x2', targetX)\r\n                        .attr('y2', targetY);\r\n\r\n                    if (phase === 3) {\r\n\r\n                        var finalX = xScale.range()[1],\r\n                            finalY = calculateY(originX, originY, targetX, targetY, finalX);\r\n\r\n                        if (finalY) {\r\n                            setFanLines(originX, originY, finalX, finalY.a, finalY.b, finalY.c);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        fibonacciFan.visible = function (value) {\r\n\r\n            if (value) {\r\n\r\n                switch (phase) {\r\n                    case 1: {\r\n                        circleOrigin.attr('display', 'inherit');\r\n                        break;\r\n                    }\r\n                    case 2: {\r\n                        circleOrigin.attr('display', 'inherit');\r\n                        circleTarget.attr('display', 'inherit');\r\n                        lineSource.attr('display', 'inherit');\r\n                        break;\r\n                    }\r\n                    case 3: {\r\n                        lineSource.attr('display', 'inherit');\r\n                        lineA.attr('display', 'inherit');\r\n                        lineB.attr('display', 'inherit');\r\n                        lineC.attr('display', 'inherit');\r\n                        fanArea.attr('display', 'inherit');\r\n                        break;\r\n                    }\r\n                }\r\n            } else {\r\n\r\n                circleOrigin.attr('display', 'none');\r\n                circleTarget.attr('display', 'none');\r\n                lineSource.attr('display', 'none');\r\n                lineA.attr('display', 'none');\r\n                lineB.attr('display', 'none');\r\n                lineC.attr('display', 'none');\r\n                fanArea.attr('display', 'none');\r\n            }\r\n        };\r\n\r\n        fibonacciFan.target = function (value) {\r\n            if (!arguments.length) {\r\n                return target;\r\n            }\r\n\r\n            if (target) {\r\n\r\n                target.on('mousemove.fibonacci-fan', null);\r\n                target.on('click.fibonacci-fan', null);\r\n            }\r\n\r\n            target = value;\r\n\r\n            target.on('mousemove.fibonacci-fan', mousemove);\r\n            target.on('click.fibonacci-fan', mouseclick);\r\n\r\n            return fibonacciFan;\r\n        };\r\n\r\n        fibonacciFan.series = function (value) {\r\n            if (!arguments.length) {\r\n                return series;\r\n            }\r\n            series = value;\r\n            return fibonacciFan;\r\n        };\r\n\r\n        fibonacciFan.xScale = function (value) {\r\n            if (!arguments.length) {\r\n                return xScale;\r\n            }\r\n            xScale = value;\r\n            return fibonacciFan;\r\n        };\r\n\r\n        fibonacciFan.yScale = function (value) {\r\n            if (!arguments.length) {\r\n                return yScale;\r\n            }\r\n            yScale = value;\r\n            return fibonacciFan;\r\n        };\r\n\r\n        fibonacciFan.active = function (value) {\r\n            if (!arguments.length) {\r\n                return active;\r\n            }\r\n            active = value;\r\n            return fibonacciFan;\r\n        };\r\n\r\n        return fibonacciFan;\r\n    };\r\n\r\n}(d3, fc));","(function (d3, fc) {\r\n    'use strict';\r\n\r\n    fc.tools.measure = function () {\r\n\r\n        var target = null,\r\n            series = null,\r\n            xScale = d3.time.scale(),\r\n            yScale = d3.scale.linear(),\r\n            active = true,\r\n            padding = 2,\r\n            formatH = null,\r\n            formatV = null;\r\n\r\n        var circleOrigin = null,\r\n            circleTarget = null,\r\n            lineSource = null,\r\n            lineX = null,\r\n            lineY = null,\r\n            calloutX = null,\r\n            calloutY = null;\r\n\r\n        var phase = 1,\r\n            locationOrigin = null,\r\n            locationTarget = null;\r\n\r\n        var measure = function () {\r\n\r\n            var root = target.append('g')\r\n                .attr('class', 'measure');\r\n\r\n            circleOrigin = root.append(\"circle\")\r\n                .attr('class', 'measure origin')\r\n                .attr('r', 6)\r\n                .attr('display', 'none');\r\n\r\n            circleTarget = root.append(\"circle\")\r\n                .attr('class', 'measure target')\r\n                .attr('r', 6)\r\n                .attr('display', 'none');\r\n\r\n            lineSource = root.append(\"line\")\r\n                .attr('class', 'measure source')\r\n                .attr('display', 'none');\r\n\r\n            lineX = root.append(\"line\")\r\n                .attr('class', 'measure x')\r\n                .attr('display', 'none');\r\n\r\n            lineY = root.append(\"line\")\r\n                .attr('class', 'measure y')\r\n                .attr('display', 'none');\r\n\r\n            calloutX = root.append(\"text\")\r\n                .attr('class', 'measure callout horizontal')\r\n                .attr('style', 'text-anchor: end')\r\n                .attr('display', 'none');\r\n\r\n            calloutY = root.append(\"text\")\r\n                .attr('class', 'measure callout vertical')\r\n                .attr('style', 'text-anchor: middle')\r\n                .attr('display', 'none');\r\n        };\r\n\r\n        function mousemove() {\r\n\r\n            if (!active) {\r\n                return;\r\n            }\r\n\r\n            switch (phase) {\r\n                case 1: {\r\n                    locationOrigin = findLocation();\r\n                    if (locationOrigin) {\r\n                        measure.update();\r\n                        circleOrigin.attr('display', 'inherit');\r\n                    }\r\n                    break;\r\n                }\r\n                case 2: {\r\n                    locationTarget = findLocation();\r\n                    if (locationTarget) {\r\n                        measure.update();\r\n                        circleTarget.attr('display', 'inherit');\r\n                        lineSource.attr('display', 'inherit');\r\n                    }\r\n                    break;\r\n                }\r\n                case 3: {\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        function mouseclick() {\r\n\r\n            if (!active) {\r\n                return;\r\n            }\r\n\r\n            switch (phase) {\r\n                case 1: {\r\n\r\n                    phase = 2;\r\n                    break;\r\n                }\r\n                case 2: {\r\n\r\n                    doMeasure();\r\n\r\n                    phase = 3;\r\n                    break;\r\n                }\r\n                case 3: {\r\n\r\n                    clearAll();\r\n\r\n                    phase = 1;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n\r\n        function findLocation() {\r\n\r\n            var mouse = [0, 0];\r\n            try {\r\n                mouse = d3.mouse(target[0][0]);\r\n            }\r\n            catch (exception) {\r\n                // Mouse is elsewhere\r\n            }\r\n\r\n            var xMouse = xScale.invert(mouse[0]),\r\n                yMouse = yScale.invert(mouse[1]),\r\n                point = findPoint(xMouse);\r\n\r\n            if (point !== null) {\r\n\r\n                var field = findField(yMouse, point);\r\n\r\n                if (field !== null) {\r\n\r\n                    return { point: point, field: field };\r\n                }\r\n            }\r\n\r\n            return null;\r\n        }\r\n\r\n        function findPoint(xTarget) {\r\n\r\n            var nearest = null,\r\n                dx = Number.MAX_VALUE;\r\n\r\n            series.forEach(function(data) {\r\n\r\n                var xDiff = Math.abs(xTarget.getTime() - data.date.getTime());\r\n\r\n                if (xDiff < dx) {\r\n                    dx = xDiff;\r\n                    nearest = data;\r\n                }\r\n            });\r\n\r\n            return nearest;\r\n        }\r\n\r\n        function findField(yTarget, data) {\r\n\r\n            var field = null;\r\n\r\n            var minDiff = Number.MAX_VALUE;\r\n            for (var property in data) {\r\n                if (data.hasOwnProperty(property) && (property !== 'date')) {\r\n                    var dy = Math.abs(yTarget - data[property]);\r\n                    if (dy <= minDiff) {\r\n                        minDiff = dy;\r\n                        field = property;\r\n                    }\r\n                }\r\n            }\r\n\r\n            return field;\r\n        }\r\n\r\n        function doMeasure() {\r\n\r\n            var originX = xScale(locationOrigin.point.date),\r\n                originY = yScale(locationOrigin.point[locationOrigin.field]),\r\n                targetX = xScale(locationTarget.point.date),\r\n                targetY = yScale(locationTarget.point[locationTarget.field]);\r\n\r\n            lineX.attr('x1', originX)\r\n                .attr('y1', originY)\r\n                .attr('x2', targetX)\r\n                .attr('y2', originY);\r\n            lineY.attr('x1', targetX)\r\n                .attr('y1', originY)\r\n                .attr('x2', targetX)\r\n                .attr('y2', targetY);\r\n\r\n            calloutX.attr('x', targetX - padding)\r\n                .attr('y', originY - (originY - targetY) / 2.0)\r\n                .text(formatV(Math.abs(locationTarget.point[locationTarget.field] - locationOrigin.point[locationOrigin.field])));\r\n            calloutY.attr('y', originY - padding)\r\n                .attr('x', originX + (targetX - originX) / 2.0)\r\n                .text(formatH(Math.abs(locationTarget.point.date.getTime() - locationOrigin.point.date.getTime())));\r\n\r\n            lineX.attr('display', 'inherit');\r\n            lineY.attr('display', 'inherit');\r\n            calloutX.attr('display', 'inherit');\r\n            calloutY.attr('display', 'inherit');\r\n\r\n            circleOrigin.attr('display', 'none');\r\n            circleTarget.attr('display', 'none');\r\n        }\r\n\r\n        function clearAll() {\r\n\r\n            locationOrigin = null;\r\n            locationTarget = null;\r\n\r\n            circleOrigin.attr('display', 'none');\r\n            circleTarget.attr('display', 'none');\r\n            lineSource.attr('display', 'none');\r\n            lineX.attr('display', 'none');\r\n            lineY.attr('display', 'none');\r\n            calloutX.attr('display', 'none');\r\n            calloutY.attr('display', 'none');\r\n        }\r\n\r\n        measure.update = function () {\r\n\r\n            if (locationOrigin) {\r\n\r\n                var originX = xScale(locationOrigin.point.date),\r\n                    originY = yScale(locationOrigin.point[locationOrigin.field]);\r\n\r\n                circleOrigin.attr('cx', originX)\r\n                    .attr('cy', originY);\r\n                lineSource.attr('x1', originX)\r\n                    .attr('y1', originY);\r\n\r\n                if (locationTarget && (phase !== 1)) {\r\n\r\n                    var targetX = xScale(locationTarget.point.date),\r\n                        targetY = yScale(locationTarget.point[locationTarget.field]);\r\n\r\n                    circleTarget.attr('cx', targetX)\r\n                        .attr('cy', targetY);\r\n                    lineSource.attr('x2', targetX)\r\n                        .attr('y2', targetY);\r\n\r\n                    if (phase === 3) {\r\n\r\n                        doMeasure();\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        measure.visible = function (value) {\r\n\r\n            if (value) {\r\n\r\n                switch (phase) {\r\n                    case 1: {\r\n                        circleOrigin.attr('display', 'inherit');\r\n                        break;\r\n                    }\r\n                    case 2: {\r\n                        circleOrigin.attr('display', 'inherit');\r\n                        circleTarget.attr('display', 'inherit');\r\n                        lineSource.attr('display', 'inherit');\r\n                        break;\r\n                    }\r\n                    case 3: {\r\n                        lineSource.attr('display', 'inherit');\r\n                        lineX.attr('display', 'inherit');\r\n                        lineY.attr('display', 'inherit');\r\n                        calloutX.attr('display', 'inherit');\r\n                        calloutY.attr('display', 'inherit');\r\n                        break;\r\n                    }\r\n                }\r\n            } else {\r\n\r\n                circleOrigin.attr('display', 'none');\r\n                circleTarget.attr('display', 'none');\r\n                lineSource.attr('display', 'none');\r\n                lineX.attr('display', 'none');\r\n                lineY.attr('display', 'none');\r\n                calloutX.attr('display', 'none');\r\n                calloutY.attr('display', 'none');\r\n            }\r\n        };\r\n\r\n        measure.target = function (value) {\r\n            if (!arguments.length) {\r\n                return target;\r\n            }\r\n\r\n            if (target) {\r\n\r\n                target.on('mousemove.measure', null);\r\n                target.on('click.measure', null);\r\n            }\r\n\r\n            target = value;\r\n\r\n            target.on('mousemove.measure', mousemove);\r\n            target.on('click.measure', mouseclick);\r\n\r\n            return measure;\r\n        };\r\n\r\n        measure.series = function (value) {\r\n            if (!arguments.length) {\r\n                return series;\r\n            }\r\n            series = value;\r\n            return measure;\r\n        };\r\n\r\n        measure.xScale = function (value) {\r\n            if (!arguments.length) {\r\n                return xScale;\r\n            }\r\n            xScale = value;\r\n            return measure;\r\n        };\r\n\r\n        measure.yScale = function (value) {\r\n            if (!arguments.length) {\r\n                return yScale;\r\n            }\r\n            yScale = value;\r\n            return measure;\r\n        };\r\n\r\n        measure.active = function (value) {\r\n            if (!arguments.length) {\r\n                return active;\r\n            }\r\n            active = value;\r\n            return measure;\r\n        };\r\n\r\n        measure.padding = function (value) {\r\n            if (!arguments.length) {\r\n                return padding;\r\n            }\r\n            padding = value;\r\n            return measure;\r\n        };\r\n\r\n        measure.formatH = function (value) {\r\n            if (!arguments.length) {\r\n                return formatH;\r\n            }\r\n            formatH = value;\r\n            return measure;\r\n        };\r\n\r\n        measure.formatV = function (value) {\r\n            if (!arguments.length) {\r\n                return formatV;\r\n            }\r\n            formatV = value;\r\n            return measure;\r\n        };\r\n\r\n        return measure;\r\n    };\r\n\r\n}(d3, fc));"]}